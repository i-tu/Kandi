	\documentclass[finnish,12pt]{article}
	\usepackage{aaltothesis}
	
%       \usepackage[T1]{inputenc}


	%% Use this if you run latex and use eps-format pictures
	%\usepackage[dvips]{graphicx}
	\usepackage[pdftex]{graphicx} 
	\makeindex
	\usepackage[pdfpagemode=None,colorlinks=false,urlcolor=red,linkcolor=blue,
citecolor=black,pdfstartview=FitH]{hyperref}

	%% Use this if you do not like hyperref package - this defines url environment and formats it correctly
	%\usepackage{url}

	% Math stuff
	\usepackage{amsfonts,amssymb,amsbsy}

	\usepackage{setspace}
	\onehalfspacing
	
  \usepackage{lmodern}
	
	% Layout
	\setlength{\hoffset}{-1in}
	\setlength{\oddsidemargin}{35mm}
	\setlength{\evensidemargin}{25mm}
	\setlength{\textwidth}{15cm}
	\setlength{\voffset}{-1in}
	\setlength{\headsep}{7mm}
	\setlength{\headheight}{1em}
	\setlength{\topmargin}{25mm-\headheight-\headsep}
	\setlength{\textheight}{23cm}

	
	\begin{document}
	
	\bibliographystyle{unsrt}

	\university{Aalto-yliopisto}
	\school{Sähkötekniikan korkeakoulu}

	\faculty{Automaatio- ja systeemitekniikan laitos}
	\degreeprogram{Automaatio- ja systeemitekniikka}
	\univdegree{BSc}
	\author{Ian Tuomi}
	\thesistitle{Automaatiokaavioiden generointi}
%	\place{Espoo}
%	\date{5.12.2012}
%	\supervisor{DI Marek Matusiak}
%	\instructor{DI Mika Strömman}
%	\uselogo{red}{!}{tkk}
%	\makecoverpage

	\keywords{Automaatiojärjestelmä, Automatisoitu suunnittelu, ohjelmoitava logiikka, PLC, IEC 61131, FBD, graafinpiirto, suunnattu graafi}
	
	\begin{abstractpage}[finnish]
  
Tämän tutkimuksen kohteena on järjestelmän ohjauslogiikan formaalin kuvauksen
muuntaminen standardeita noudattavaksi logiikkakaavioksi.
  
	\end{abstractpage}

	\newpage
	\vspace{10cm}
	\mysection{Esipuhe}

Ilman seuraavia ihmisiä en olisi onnistunut tässä työssä.

Ohjaajaani Mika Strömmania hyvistä huomioista ja asiallisesta palautteesta ja skarpista ohjauksesta.

Petri Kokkoa ja Pekka Niemistä ideoinnista ja suunnannäyttämisestä.

Kandiryhmäni jäseniä Lauri Vepsäläistä, Heikki 'Taffis' Tahvanaista, Panu Kauppista, Peter 'Bembu'  Kronströmiä ja Lauri Andleria.

Aalto- yliopiston henkilökuntaa hyvästä työstä.
Vanhempiani tuesta ja kannustuksesta.

	\vspace{5cm}

Otaniemi, 
Itsenäisyyspäivänä 6.12.2012

	\vspace{5mm}
	{\hfill Ian Tuomi \hspace{1cm}}

	\newpage

%	\addcontentsline{Sisällysluettelo}

	\tableofcontents


%% Käsitteet
	\mysection{Käsitteet ja lyhenteet}

	\begin{tabular}{ll}
Lanka        & Distributed Control System \\
	     	      & Hajautettu ohjausjärjestelmä \\ \\
	     	    
DCS        & Distributed Control System \\
        &   Hajautettu ohjausjärjestelmä \\ \\
        
FBD         & Function Block Diagram, IEC 61131-3 -standardin määrittelemä logiikkaohjelmointikieli\\\\
IEC          & International Electrotechnical Commission\\\\
PLC         & Programmable Logic Circuit \\
	      & Ohjelmoitava logiikkapiiri\\\\

	\end{tabular}

	\cleardoublepage
	\storeinipagenumber
	\pagenumbering{arabic}
	\setcounter{page}{1}

% Kandi %

	\section{Johdanto}
	\thispagestyle{empty}

Teollisen automaatiojärjestelmän suunnittelutyön tulos koostuu suuresta määrästä erilaisia dokumentteja.
Laajan järjestelmän tapauksessa kyse voi olla jopa tuhansista yksittäisistä kaavioista, asettelukuvista ja listauksista.
Ne yhdessä muodostavat kuvauksen, joka mahdollistaa järjestelmän toteutuksen, käyttöönoton ja ylläpidon.
Dokumentaation laatiminen käsin on suurissa projekteissa työlästä ja tehotonta.
Nykyaikaisessa automaatio- ja instrumentointisuunnittelussa ongelma korostuu.
Ratkaisuista on tullut monimutkaisempia ja laatu- ja joustavuusvaatimukset ovat lisääntyneet.
Lisäksi vaaditut toteutusajat ovat jatkuvasti lyhentyneet.
\cite{RefWorks:41}

Suunnitteluprosessiin kohdistuneista vaatimuksesta johtuen työtä on pyritty tehostamaan automatisoiduilla apuvälineillä.
Alan metodiikka ei ole ilmeisistä standardoimiseduista huolimatta yhtenäistynyt ja yhteistyö alan tutkimuksessa on vähäistä.
Vaikka lähestymistavat ovat vaihtelevia, alalla on kuitenkin nähtävissä yhtenäinen siirtymä kohti jaettuja tietomalleja.

Automaatiojärjestelmien suunnittelun näkökulmasta jaettujen tietomallien käyttö tarkoittaa,
että suunnittelujärjestelmään tallentuu projektin edetessä kaikki sähköistys ja instrumentointi automaatiojärjestelmineen ja kenttälaitteineen.
Erilaiset kaaviot voidaan tuottaa suoraan tietomallin sisältävästä tietokannasta.

Tietomalliin perustuva lähestymistapa vaatii sen laajuuden ja rajoitukset määrittelevän metamallin.
Se ohjaa ja määrittää suunnittelun kohteen lisäksi myös yleisesti suunnittelutöiden kulkua.

Tämän tutkimuksen kohteena on hajautetun ohjausjärjestelmän logiikan tietomallin muuntaminen standardeja noudattavaksi kaavioksi.
Logiikkakaavio on tapa pelkistää järjestelmän eri osien syöttöjen ja lähtöjen välillä vallitseva logiikka visuaaliseen ja helposti ymmärrettävään muotoon.
Se on määritelty yksiselitteisesti ja on tulkittavissa suunnatuksi graafiksi, jolloin algoritmillisen graafinpiirron tuloksia voidaan hyödyntää.

Algoritmillinen graafipiirto on perusteellisesti tutkittu ala, jonka tuloksia voidaan käyttää kaikenlaisten suunnattujen kaavioiden piirtoon.
Työssä esitellään Sugiyaman ym. \cite{RefWorks:9} esittämään hierarkiseen lähestymistapaan perustuva, tietovirtakaavioiden esittämiseen soveltuva algoritmi.

Esimerkki tyypillisestä teollisuuden logiikkakaaviosta esitellään ja se asetellaan se käyttäen esiteltyä algoritmia.
Lisäksi pohditaan miten työn menetelmät voitaisiin toteuttaa laajemmalla mittakaavalla.

	\clearpage
	\section{Tehtaan mallit}

Tehdasmalli on kuvaus, joka mahdollistaa tehtaan toteutuksen, käyttöönoton ja ylläpidon.
Se on tietomalli, joka kuvaa tehtaan toimintaa, sen prosessia, organisaatiota, ihmisiä ja näitten aktiviteetteja.
Pohjimmiltaan se koostuu tehdasobjekteista ominaisuuksineen sekä niitten välisistä relaatioista. \cite{RefWorks:41}

Suunnittelijoilla on työtehtävistään riippuen erilaisia tarpeita tehdasmallin suhteen.
Työn kohde on monitahoinen eikä mikään yksi malli pysty kattamaan kaikkia suunniteltavan järjestelmän näkymiä.
Tehdasta tulee kuvata useilta eri näkökannoilta erilaisilla tarkkuuksilla kunkin näkymän vaatimuksien mukaisesti.
Tehdasmalliin kuuluu siis useita malleja, jotka yhdessä muodostavat kokonaismallin.

Jokaisella mallilla on myös metamalli. Se määrittelee millaisia objekteja malli voi sisältää, mitä ominaisuuksia sillä voi tai täytyy olla ja millaisia yhteyksiä objektien välillä on.
Metamallin loogiset riippuvuudet määrittelevät suunnittelun työtapoja ja järjestystä.
Ne kuvaavat millaiset tietomallit ovat suunnittelujärjestelmän kannalta hyväksyttäviä tehdasmalleja ja
määräävät sen laajuuden. Metamallin määritteleminen tekee työn tuloksesta ennakoitavan ja mahdollistaa tehokkaiden apuvälineiden kehittämisen.
Määrittelyllä myös suljetaan pois eriäviä tapoja kuvata tehdasta ja mahdollistetaan määrittelyyn perustuvat työkalut ja suunnittelukäytännöt.
Tällaisia ovat esimerkiksi uudelleenkäytettävää koodia sisältävät kirjastot ja erilaiset mallimuunnokset.

Suunnittelussa käytettävät metamallit valitaan siten, etteivät ne ole ristiriidassa ja muodostavat yhdessä toisiaan täydentävän kokonaisuuden.
Tällöin metamallien konfiguraatio muodostaa itsessään mallin.


	\subsection{Automaatiojärjestelmän kuvaukset}

Teollisuuden hajautettujen ohjausjärjestelmien suunnittelussa on havaittu
tarpeellisiksi ainakin kolme kuvausta: toiminnallinen, fyysinen sekä ohjelmistollinen \cite{RefWorks:38}.

		\subsubsection{Toiminnallinen kuvaus}

Toiminnallinen kuvaus määrittelee säätöjärjestelmän toiminnan tavalla, joka toteutettuna täyttää sille asetetut \emph{käyttäjävaatimukset}.
Se kuvaa järjestelmän toimintaa ja, muttei välttämättä määrittele sen tarkkaa teknistä toteutusta. \cite{RefWorks:60}

Tätä näkymää määrittäessä voivat eri alojen suunnittelijat osallistua työhön ilman
tuntemusta instrumentoinnista tai ohjelmistokehityksestä. Kun päätökset on tehty
abstraktilla tasolla, voidaan hankinnat räätälöidä sen mukaisesti ja tulos
toteuttaa tehokkaasti.
Tällaisen määrittelyn avulla on mahdollista käyttää formaaleja verifiointimenetelmiä joitten avulla
voidaan osoittaa, että järjestelmän suunnitelma toteuttaa sille asetetut vaatimukset.
Näin suunnitelman oikeellisuus voidaan osoittaa ennen investointeja toteutukseen. \cite:{RefWorks:41}

		\subsubsection{Fyysinen näkymä}

Fyysiseen näkymään suunnitellaan järjestelmän johdotukset, kaapelit, kenttäväylät,
ohjauskeskukset, toimilaitteiden sijainnit sekä ylipäänsä kaikki mitä vaaditaan 
järjestelmän fyysiseen käyttöönottoon.


		\subsubsection{Ohjelmistonäkymä}

Ohjelmistonäkymä kattaa funktionaalisen suunnittelun toteutuksen ohjelmamuodossa.
Asiakkaalla on yleensä omat toiveensa sen suhteen, millaiseen muotoon ohjelma tehdään.
Ohjelmiston toteuttamiseen ei pitäisi liittyä enää suunnittelutyötä - toisin sanoen toiminnallisen kuvauksen määrittelyjen täytyy olla riittävän tarkkoja jotta niitten mukaan tehdyssä ohjelmassa ei ole sen toimintaan vaikuttavia tulkinnanvaraisuuksia.

Ohjelmistototeutuksen työtavat jäävät usein määrittelemättömiksi ja muusta suunnittelutyöstä irrallisiksi,
vaikka pyrkimyksiä toteutustapojen nitten integroimiseksi suunnitteluprosessiin entistä vahvemmin on ollut.
Toteutustapa jää yksittäisten suunnittelijoiden määriteltäväksi, mistä seuraa että yhtenäistä työtapaa harvoin on.
Toteutetun ohjelmakoodin uudelleenkäyttö jää myös tyypillisesti vähäiselle asteelle. \cite{RefWorks:42}


	\subsection{Logiikan kuvaukset}

%McAvinew ym. \cite{RefWorks:53}
%Meier, automation body of knowledge: \cite{RefWorks:54}
%http://www.geocities.ws/andrikuncoro/Instrumentation/1811_06.pdf

Logiikan kuvaukset helpottavat tehtaan toiminnan ymmärrystä suunnittelu- ja rakennusvaiheen lisäksi tehtaan ylläpidon ja huollon yhteydessä ja ovat siksi tärkeä osa tehtaan lopullista dokumentaatiota.
Loogista järjestelmää voidaan kuvata monin erilaisin tavoin.
Nämä erilaiset kuvaukset voivat näyttää erilaisilta, mutta olla silti täysin yksiselitteisiä suhteessa kuvattuun järjestelmään.
Teollisessa automaatiosuunnittelussa sallitut logiikan esitystavat on määritelty erityisesti selkeyttä, turvallisuutta ja ennustettavaa toimintaa silmälläpitäen.
Jatkuva prosessiohjaus voidaan esittää selkeästi järjestelmän PI-kaavioissa, mutta diskreetin ohjauksen esittämiseen tarvitaan erilaisia esityksiä, kuten logiikkadiagrammeja. \cite{RefWorks:54}

Logiikkadiagrammit kuvaavat syöttöjen ja lähtöjen välistä logiikkaa.
Määrittelyn mukaisia kaavioita ei kuitenkaan ole välttämättä helppoa laatia.

Kun kaavioista tulee monimutkaisia, kuluu niitten asetteluun huomattavan paljon aikaa silloin, kun tavoitteena on mahdollisimman luettava kaavio.
Klausken ja Dziobekin mukaan kaavioiden asetteluun kuluu suunittelijoiden ajasta n. 30\%. \cite{Refworks:63}
Koska työaika on yrityksessä rajallinen voimavara, 

Kun tietokoneen avulla toteutettava algoritmillinen muunnos kuvauksesta kaaviomuotoon onnistuu ilman suunnittelijalle siitä koituvaa vaivaa tai aikaa, kannattaa suunnittelijan laatia kahdesta kuvaustyypistä helpompi ja antaa algoritmin hoitaa lopullisen kuvauksen laatiminen.
Algoritmillisesti laaditut kaaviot voivat olla jopa parempia kuin käsintehdyt  \emph{[lähde on, pitää kaivaa]}

		\subsubsection{Toimintakaaviot}

Toimintakaavio on funktionaalisen näkymän toteutus, joka tavallisesti valmistellaan järjestelmän suunnittelun varhaisessa vaiheessa prosessikaaviosta.
Se määrittelee ohjausjärjestelmän toiminnot ja sitä pidetään ajantasaisena järjestelmän suunnittelun edetessä.
Se toimii suunnittelun apuna ja on lopulta osa lopullisen järjestelmän ohjeistusta.

\emph{Suomen automaatioseura}

		\subsubsection{Ohjelmakoodi}

Ohjelmakoodi on ohjelmanäkymän toteutus.
IEC~61131-3 on laajassa käytössä oleva avoin ohjelmakoodin standardi joka määrittelee automaatiologiikan ohjelmointimenetelmät ja pyrkii olemaan riittävän joustava mihin tahansa tarkoitukseen. \cite{RefWorks:62}
Se sisältää viisi erilaista ohjelmointikieltä, joista tässä työssä käsitellään erityisesti FBD:tä.

FBD-kieli koostuu toimilohkoista ja niiden välisistä langoista.
Toimilohkot kuvaavat toisistaan erillisiä itsenäisiä laskennallisia yksiköitä.
Langat kuvaavat niitten relaatioita toisiinsa.
Toimilohko voi tilastaan riippuen lähettää tapahtumia jotka vaikuttavat muitten blokkien toimintaan.
Sen tekemien laskutoimitusten tulos riippuu sen vasemmalta puolelta tulevista syöttötiedoista ja sen suorittaman laskennan tulokset lähetetään blokin oikealta puolelta.
Toisiinsa liitetyt funktioblokit muodostavat verkon, joka määrittelee laajemman toiminnallisuuden. \cite{RefWorks:55}

Funktioblokkien editointiin on olemassa useita työkaluja.
Näistä mainitsemisen arvoisia ovat ainakin FBDK, 4DIAC ISaGRAF ja NxtControl.
Ne eivät kuitenkaan tarjoa graafien asetteluun kuin alkeellisia työkaluja, jotka pikemmin helpottavat suunnittelijan asettelua kuin tuottavat itsessään ratkaisuja.

Automaatiokaavioiden suoritusjärjestys etenee standardin IEC 61131-3 mukaan vasemmalta oikealle.
Lisäksi toimilohkoa ei ajeta ennen kuin kaikki sitä edeltävät toimilohkot on suoritettu.
Keskinäisen suoritusjärjestyksen täytyy myös tulla esille toteuttavassa ohjelmistossa.
Suoritusjärjestys kulkee usein ylhäältä alas, mutta tätä ei voi olettaa aina todeksi. \cite{RefWorks:62}

Suoritusjärjestysvaatimus asettaa seuraavassa kappaleessa tarkasteltavalle graafinpiirrolle rajoituksia.
Jos niitä ei oteta huomioon, saattaa graafin algoritmillinen piirto johtaa vääränlaiseen kaavioon.
Mahdollisten takaisinkytkentöjen tapauksessa vaaditaan huolellisuutta, jottei syklien poistovaiheessa kaavion järjestys muutu.


		\subsubsection{Logiikan tietokantakuvaukset}

Suunniteltu logiikka tallennetaan jaettuun suunnittelumalliin, johon kaikilla järjestelmän suunnittelijoilla on yhteys.
Tapa jolla logiikka tallennetaan täytyy olla yhdenmukainen, jotta suunnittelutyössä voidaan tehdä tehokasta yhteistyötä työpaikalla jaettujen yhtenäisten suunnittelun apuvälineiden avulla.
Lisäksi kuvauksen tulee olla formaali jotta logiikkaa voitaisiin käsitellä algoritmillisesti.
Formaalilla tarkoitetaan tietynlaista, tarkkaan määritetyn syntaksin mukaista kuvausta.
Tällöin tulee myös mahdolliseksi toteuttaa helposti tietoa käsitteleviä muunnosalgoritmeja.
Muunnoksella tarkoitetaan jonkin tiedon kuvauksen muuttamista toiseksi kuvaukseksi.

Standardin IEC 61131-3 mukaisten ohjelmointikielten kuvaamiseksi on ehdotettu PLCopen-standardia.
PLCopen -standardin mukainen logiikan XML-esitys voi sisältää toimilohkon toiminnallisuuden kannalta välttämättömien asioiden lisäksi toimilohkon sijainnin, koon ja jopa lankojen reititykset.
PLCopen -standardin mukainen esitys voidaan tällöin laatia siten, että se on tuotettavan kaavion asettelun kannalta täysin yksiselitteinen.
Tällaista esitystä voidaan silloin pitää dokumentaation lopullisena muotona. \cite{RefWorks:64}

Kun logiikkakuvauksen muoto on määritelty tarkasti, voidaan määritelmän mukaisesti laadittu logiikkakuvaus muuntaa määritelmään nojaavien sääntöjen perusteella.
Monet automaatiologiikan suunnitteluohjelmistot pystyvät muuntamaan käyttämänsä kuvauksen PLCopen-muotoiseksi tiedoksi, jolloin suunnittelutietoa voidaan siirtää eri järjestelmien kesken.
Erilaisia XML-kuvauksia on helppoa laatia ja niitten sisältämien tietojen pohjalta voidaan tuottaa XSL-muunnoksilla. \cite{RefWorks:61}

Olemassaolevien suunnitteluohjelmistojen varaan rakennettu suunnittelujärjestelmä voi kohdata haasteita, jos se perustuu ohjelmien standardinmukaisuuteen.
Valmistajat jättävät usein standardinmukaiseksi kutsutuista ohjelmistoista määrittelyn mukaisia ominaisuuksia toteuttamatta.
Tämä johtuu standardinmukaisuuden määritelmästä: ohjelma on standardinmukainen, jos se toteuttaa standardista jonkin osan ja mainitsee mitä se jättää toteuttamatta. \cite{RefWorks:42}

	\clearpage
		
	\section{Graafit ja niiden asettelu}

	\subsection{Määritelmiä}
% http://www.cs.brown.edu/~rt/gdhandbook/

Lähdetään liikkeelle graafin määritelmästä \cite{RefWorks:39}.
Graafi on yleisen määritelmänsä mukaan joukko solmuja ja niitä yhteen liittäviä lankoja.
Lankoja kutsutaan usein myös kaariksi, reunoiksi, väleiksi tai linkeiksi. Solmusta käytetään myös ilmaisua noodi.
Matemaattisesti esitettynä graafi on joukko $G = (V, E)$, missä V on rajoitettu solmujoukko ja E on rajoitettu lankajoukko.

Kerrostus on jaottelu $\mathfrak{L} = (L_1, L_2, ..., L_h)$, jonka alajoukot sisältävät yhdessä kaikki solmut $V$.
Solmujoukon erilaisia kerrostuksia vertaillaan jaottelun \emph{leveyden} ja \emph{korkeuden} avulla.
Korkeus\footnote{Tietovirtakaavioissa vasemmalta oikealle} on kerrosten määrä $h$ ja leveys\footnote{Tietovirtakaavioissa ylhäältä alas} on suurimman kerrosjoukon $L_i$ koko.

Laajennetaan määritelmää ja sisällytetään graafin määritelmään joukko portteja $P$ ja funktio $\mathsf{n} : P \rightarrow V$, joka kartoittaa portit niitä vastaaville solmuille.

Lanka koostuu porttiparista, joita se yhdistää. Graafi on \emph{suunnattu} silloin, kun sen langat ovat järjestettyjä pareja, joista toinen on tulo- ja toinen lähtöpiste. Toisinsanoen, $e = (p_1, p_2)$, missä $p_1$ on lähtö- ja $p_2$ tuloportti.

Solmu $v_j$ on solmun $v_i$ \emph{seuraaja} silloin, kun on olemassa lanka $e \in E$, jolle $\mathsf{n}(p_1) = v_i$ ja $\mathsf{n}(p_2) = v_j$.
Polku on solmusekvenssi $(v_1, v_2, ..., v_k)$ jolle pätee, että $k>1$ ja jokainen sekvenssin solmu $v_{i+1}$ on solmun $v_i$ seuraaja.

Graafi on \emph{syklitön} silloin, kun mikään polku ei sisällä samaa solmua enemmän kuin kerran.
Lanka $(p_1, p_2)$ on \emph{itseohjautuva} silloin, kun $\mathsf{n}(p_1) = \mathsf{n}(p_2)$.
Kerrostus on \emph{kunnollinen}\footnote{eng. proper} silloin, kun jokaisen kerrostusjoukon $L_i$ jokaisen solmun seuraajat kuuluuvat kerrost

\emph{Virityspuu} on verkon aliverkko joka sisältää verkon kaikki solmut, siten että se sisältää mahdollisimman vähän lankoja.
Voidaan osoittaa, että

 		\subsection{Tulosten arviointiperusteet}

Asetteluista halutaan mahdollisimman esteettisiä.
Estetiikka erittelee ominaisuudet mitä graafiin halutaan mahdollisimman paljon, jota se olisi mahdollismman luettava.
Purchase ym. ovat tutkineet estetiikkaan vaikuttavia tekijöitä. \cite{RefWorks:47}

Tärkeimmät ominaisuudet järjestyksessä Purchase et. al. mukaan: 
\begin{enumerate}
  \item Lankojen risteysmäärä
  \item Kaavion koko
  \item Lankojen yhteispituus
  \item Pisin lankapituus
  \item Symmetria
\end{enumerate}

Näistä ominaisuuksista lankojen risteysmäärä muodostui tärkeimmäksi. Myös lankojen pituus oli merkittävässä asemassa luettavuuden kannalta.

Esteettiset ominaisuudet ovat usein ristiriidassa keskenään.
Jotta voitaisiin esimerkiksi välttää langan piirto solmun läpi, joudutaan siihen usein tekemään mutkia.
Kompromisoimattoman esteettiset kaaviot ovat harvinaisuuksia.

Valmiin kaavion asettelua voidaan arvioida automatisoidusti laskemalla kaavioista esteettisyyteen vaikuttavia tekijöitä, kuten lankojen risteysmääriä.

	\subsection{Liittyvä työ}

Suurin osa graafinpiirrollisista lähestymistavoista on suunniteltu ennalta tuntemattomien verkkojen piirtämiseen. Ne pyrkivät tuottamaan keskimäärin hyvän asettelun, oli graafi millainen hyvänsä.
Suunnatun verkon rakenteen huomioonottavat algoritmit tuottavat parempia tuloksia, kun on ennalta tunnettua että verkko on suunnattu.

Suunnattuja graafeja käytetään laajalti riippuvuussuhteiden mallintamiseen.
Esimerkkejä suunnatuista graafeista ovat projektinhallintaverkot, ontologioiden määrittelykaaviot (kuuluu ryhmään), ohjelmien kutsupuut, syy-seurausdiagrammit sekä aiemmin osioissa 2.2.1 ja 2.2.2 käsittelemämme toiminta- ja ohjelmakoodikaaviot.
Kerroksittainen tapa esittää syklittömiä ja suunnattuja verkkoja on intuitiivinen ja helppolukuinen.

Varhaisimpia algoritmeja kerrostettujen graafien asetteluun ovat kehittäneet Warfield \cite{RefWorks:58}, Carpano \cite{RefWorks:57} ja Sugiyama ym. \cite{RefWorks:9}.
Näistä viimeiseksi mainittu jaottelee algoritmin vaiheisiin, joista jokaista voidaan tutkia erillisenä ongelmana. Sugiyama ym. alkuperäistä algoritmia käytetään nykyaikaisissa algoritmeissa vain vähäisin osin.

Sen määrittelemä työvaiheiden jaotetlu on kuitenkin säilynyt hierarkisen graafinpiirron tutkimuskentässä.
Vaiheet ovat järjestyksessä kerrosten vähennys.
Myöhemmin käsiteltävä suuntaus ja lankojen reititys ovat jälkikäteen lisättyjä osioita.

%[GKNV93, Car80, ES91, GNV88, GM89, MES88, MRH91, PT90]

Sitä ei kuitenkaan useista syistä voi käyttää sellaisenaan tietovirtakaavioiden asetteluun.
Aseteltavissa tietovirtakaavioissa esiintyvät toimilohkot sisältävät useita portteja, joiden keskinäinen järjestys on säilytettävä.
Lisäksi Sugiyaman lähestymistavassa langat eivät ole tietovirtakaavioissa yleisen käytännön mukaisesti ortogonaalisia, jolloin algoritmia pitää täydentää erillisellä langoille tarkoitetulla reititysalgortimilla.

Gansner ym. esittivät porttiongelmaan ratkaisun, joka perustuu noodisijoitteluesityksen laajentamiseen porttien suhteellista sijaintia kuvaavalla tiedolla.\cite{RefWorks:28}
Sander ym. esitti reititysongelmaan ratkaisun, jossa käsitellään yksitellen jokaisen ruudun ylittävien lankasegmenttiryhmää omana graafiongelmanaan, johon sovelletaan suurempaan ongelmaankin käytettäviä graafinpiirron menetelmiä. \cite:{RefWorks}
a
Työvaiheista kerrostus ja risteyksien vähennysvaihe saattavat muuttaa suoritusjärjestystä.
Tällöin algoritmin toimintaa pitää yksinkertaisesti rajoittaa järjestysherkkien blokkien osalta.
Koska algoritmit ovat heuristisia, ovat siihen tehtävät yksinkertaiset rajoitukset helppoja toteuttaa.

Toimilohkojen syötöt ovat yleensä lohkon vasemmalla ja ulostulot oikealla puolella.
Näin on FBD-ohjelmointikielen tapauksessa aina.
Toimintakaavioiden tapauksessa syöttöjen ja ulostulojen sijainteja ei ole määritelty yhtä tarkasti, jolloin sivuportit on otettava asettelevassa algoritmissa myös huomioon jos sitä halutaan käyttää.
Sivuporttien huomioonottoon on esitetty ratkaisu, jossa lankojen reititystä varten asetetaan valesolmuja. \cite{RefWorks:51}

Sovelluksia graafinasettelualgoritmeille mallipohjaisessa suunnittelussa ovat kehittäneet ainakin Klauske...


		\subsection{Graafinasettelualgoritmi}

Työssä käytetty algoritmi seuraa Klauske ym. kehittämää datavirtauskaavioiden rajoitukset huomioon ottavaa lähestymistapaa joka yhdistelee useita sopivia graafinpiirron menetelmiä \cite{RefWorks:50}.

Se koostuu viidestä eri vaiheesta:
\begin{enumerate}
  \item Syklien poisto, seuraa Eades et al.\cite{RefWorks:48}
  \item Kerrostus, seuraa Gansner et. al., lankapituuden minimimoivaa menetelmää. \cite{RefWorks:28}
  \item Risteysten vähentäminen, seuraa Sugiyama ym. alkuperäistä menetelmää. \cite{RefWorks:9}
  \item Poikittaisasettelu, seuraa Sanderin lineaaristen segmenttien menetelmää. \cite{RefWorks:49}
  \item Lankareititys, seuraa Sanderin monilankareititysalgoritmia. \cite{RefWorks:17}
\end{enumerate}

Nämä vaiheet ovat toisistaan erillisiä ja voidaan tilanteen mukaan vaihtaa toisiksi tai jättää suorittamatta.
Jos esimerkiksi toimilohkojen paikat halutaan pitää paikallaan mutta laatia lankojen reititykset automaattisesti, voitaisiin päättää ajaa pelkästään algoritmin viides osio.

		
		\subsubsection{Syklien poisto}

Syklinpoistovaiheessa muotoillaan graafi siten, että se on syklitön.
Syklittömyys on määritelty tarkemmin osiossa \emph{3.1}.
Säätötekniikassa yleiset takaisinkytkennät ovat määritelmänsä mukaisesti syklejä.

Syklejä ei voida asettelualgoritmin syklittömyysvaatimuksesta huolimatta poistaa.
Tämän vuoksi syklit rikotaan kääntämällä yksi syklin sisältämistä langoista.
Tätä jatketaan kunnes graafi on asyklinen.
Syklillisen graafin muuntaminen syklittömäksi, eli käännettävien lankojen valinta siten että niitä on mahdollisimmanvähän on NP-vaikea.\emph{[lähde]}

Syklien poistovaiheessa käsiteltävä tietomalli kuitenkin sisältää syklipoistoa helpottavaa tietoa, nimittäin jokaisessa puussa ensimmäisenä suoritettavan noodin. Tämä merkittävästi helpottaa syklinpoistovaihetta, ja graafin suuntaamisesta tuleekin triviaali toimenpide. [?]

Käännetyt langat käännetään lankojen reitittämisvaiheessa takaisin oikein päin.
Kun graafissa ei ole syklejä, voidaan määritellä noodien keskinäinen topologinen kerrostus.

		\subsubsection{Kerrostus}

%Kerrostusvaiheessa ratkaistava vähimmäisongelma on, että jokaisen noodin seuraajanoodin täytyy olla suurempaa kerroslukua kuin mitä se itse on.
Kerrostukselta vaaditaan, että se on \emph{kunnollinen} osion 3.1 mukaisesti.
Tämän saavuttamiseksi graafiin lisätään \emph{vale}solmuja pitkien lankojen katkaisemiseksi.
Kerrostukseen halutaan valesolmuja mahdollisimman vähän.

Mahdollisimman kompakti kerrostus on haluttava.
Tämä tarkoittaa että sen leveys ja pituus ovat pieniä ja kerrosten välinen etäisyys on vakio. 
Käytännössä rajoituksena toimii tarkastelutavasta riippuen näyttöpääte tai paperi, jolta graafia on tarkoitus tarkastella.
Graafin pituuden alaraja on sen sisältämän pisimmän yhtenäisen ketjun pituus.
Tarkastelemalla tätä pituutta saadaan kuva lopullisen kuvan leveydestä.

Erilaisilla kerrostusmenetelmillä graafin pituus voidaan minimoida leveyden kustannuksella tai siitä voidaan tehdä mahdollisimman kapea pituuden kustannuksella.

Sekä leveyden että pituuden minimointi samanaikaisesti on rinnastettavissa multiprosessoriajastusongelmaan ja on siten NP-täydellinen ongelma. \cite{RefWorks:39}
Kun halutaankin mahdollisimman lyhyitä kerrostuksia, on suotavaa käyttää multiprosessoriajastusongelman ratkaisemiseksi kehitettyä Coffmann-Graham -algoritmia. \cite{RefWorks:59}
Käyttöön tarkoitetun graafin pituuden rajoittaminen ei kuitenkaan ole tavoitteena, 

Työssä käytetään lineaarisen ohjelmoinnin menetelmää, \emph{Network Simplex}- algoritmia.
Sen aikakompleksisuutta ei ole pystytty osoittamaan, mutta se on käytännössä osoittautunut suoritusajaltaan nopeaksi.

Menetelmässä laaditaan ensiksi graafin \emph{virityspuu}.
Kerrostamisessa valitaan ensin lähdesolmu, jonka kerros on $L_0$.
Jokainen solmun seuraaja asetetaan kerrokseen $L_1$ ja niin edelleen

Kun mahdollinen virityspuu on laadittu, käytetään hyväksi virityspuun ominaisuutta, että jos jokin sen lanka poistetaan, tuotetaan kaksi toisistaan erillistä puuta,
Jokaiselle langalle määritellään \emph{leikkausarvo}.
Leikkausarvolla tarkoitetaan kaikkien lankojen summaa päänoodista loppunoodiin, josta vähennetään 

\begin{itemize}
	\item Mahdollinen virityspuu.
	\item 

\end{itemize}


		\subsubsection{Risteyksien vähentäminen}

% Tähän se väikkäri myös! (P. Eades, ”Heuristics for Reducing crossings in
% 2-layered networks”, E. Mäkinen, ”experiments of drawing 2-level hierarchical %graphs”,
% M. Jünger, ”2-layer straightline crossing minimization: Perf…” )

Lankojen risteysten määrä on osoittautunut olemaan suurin yksittäinen tekijä graafin luettavuuden kannalta. \cite{RefWorks:47}
Risteysmäärän vähentäminen pieneksi on tällöin mille tahansa luettavuutteen tähtäävälle asettelualgoritmille tärkeä tavoite.

Graafin kokonaisristeysmäärän vähentäminen ei perustu solmujen tarkkoihin sijainteihin, vaan niitten keskinäiseen järjestykseen.
Ongelma on siis luonteeltaan kombinatorinen eikä geometrinen, mikä huomattavasti yksinkertaistaa hyvän ratkaisun löytämistä.
Graafi on myös muokattu kerrostamisvaiheessa kelvolliseksi, minkä seurauksena ongelmaa ratkaistessa voidaan keskittyä vuorotellen vain kerrosparin $L_i$ ja $L_{i+1}$ välisiin lankoihin.
Näistä helpotuksista huolimatta kyseessä on NP-täydellinen ongelma siinäkin tapauksessa että koko graafissa on kerroksia vain kaksi. \cite{RefWorks:40}

Parhaan mahdollisen kombinaation löytämiseksi joudutaan yksinkertaisen ratkaisun puutteessa käyttämään heuristisia menetelmiä.
Eräs suosittu lähestymistapa perustuu solmun seuraajasolmujen sijoittamiseen mahdollisimman lähelle lähdettään.
Teorian kannalta tällä nk. mediaanimenetelmällä on useita hyviä ominaisuuksia.
Sen avulla tuotettu ratkaisun risteysmäärä on vakiossa suhteessa optimaaliseen.
Lisäksi algoritmi voidaan suorittaa polynomisessa ajassa.
Käytännön kokeiluissa satunnaisilla graafeilla on kuitenkin todettu, ettei mediaaneihin perustuva menetelmä ole käyttökelpoisin. \cite{RefWorks:52}
Battisti ym. suosittelevatkin eri menetelmiä yhdisteleviä hybridialgoritmeja, kuten mediaanimenetelmän ja satunnaisten tranpositioiden yhdistämistä\cite{RefWorks:39}.

Työssä käytetty algoritmi arpoo ensimmäisen kerroksen $L_1$ järjestyksen.
Se sitten etenee kerroksittain eteen- ja taaksepäin tehden järjestykseen transpositioita.
Risteysten määrät lasketaan eri tuloksista ja ratkaisu, jossa on vähiten risteyksiä valitaan lopulliseksi.

%Optimizing Automatic Layout for Data Flow Diagrams, 2011, Diploma thesis,
%Christian-Albrechts-Universität zu Kiel, Department of Computer Science

		\subsubsection{Poikittainen asettelu}

Jokainen kulma langassa aiheuttaa ylimääräisen rasitteen ihmisen hahmotuskyvylle. \cite{RefWorks:47}
Esteettistä lopputulosta tavoittelevan asettelualgoritmin tulee siis pyrkiä minimoimaan lankojen kulmat.
Siinä missä noodikerroksien noodikombinaatiot vaikuttavat lankojen risteysten määrään, vaikuttaa niiden tarkka poikittainen asettelu langoissa olevien kulmien määrään.
Solmujen poikittaisen asettelun avulla solmujen välisten lankojen käännösten määrää pyritään vähentämään jotta kaavion luettavuus paranee.
Asettelun merkitys korostuu kun lankoja on paljon, kuten automaatiologiikkakaaviolle on tyypillistä.

Risteysten vähentämisvaiheessa saavutettu kombinatorinen ratkaisu säilytetään poikittaisasetteluvaiheessa.

Poikittainen asettelu tuottaa pitkittäiset noodipositiot $1...m$ sekä poikittaiset positiot $1...n$.
Samalla poikittaisella positiolla olevien noodien välille voidaan reitittää suoria lankoja, joten solmujen seuraajat pyritään sijoittamaan samalle poikittaispositiolle jos mahdollista.

Aluksi pyritään tuottamaan asettelu, joka on ylipäänsä mahdollinen.
Tämä tehdään jakamalla poikittais- ja pystypositiot yksinkertaisesti pienimmästä suurimpaan.
Tämän jälkeen graafin solmut lajitellaan topologisesti.
Suunnatun graafin topologinen lajittelu

Kun on saavutettu yksinkertaisin mahdollinen asettelu, voidaan siirtyä tasapainottamaan asettelua.
Solmuasettelu tasapainoitetaan mallintamalla solmuja levossa olevina heilureina.
Solmut ovat heilurin päässä oleva paino ja lanka painoa kannatteleva naru.
Tasapainotettavaa kerrosta seuraava kerros pysyy kiinteänä paikoillaan.

Liikutettavat asiat ovat eivät ole yksittäisiä noodeja vaan lineaarisia segmenttejä.
Ne pysyvät suorina linjoina.

Pallot löytävät tasapainopisteensä.
Mallinnettavat 

seuraavat ehdot:

\begin{enumerate}
	\item Asette\end{enumerate}

Seurauksena lanka, joka ennen poikittaista sijoittamista sisälsi mutkia, voidaan piirtää suoraksi saman lineaarisen osion sisällä.
Noodit, jotka eivät ole muussa segmentissä, ovat omassaan.

\begin{enumerate}
	\item Segmentteihin jako kerroksen sisällä
	\item Asetetaan alkuperäiset sijainnit, jotka mahjdollisimman pienet
	\item Heilurimenetelmä (Poikkeamat-segmentointi-sijoittelu)
	\item Ruudukkoon asettelu
\end{enumerate}


\cite{RefWorks:49}




		\subsubsection{Lankojen reititys}

%Jokaista lankajoukkoa kohden luodaan pystysuuntainen runkolanka.

Kaavion langat reititetään lopulta ortogonaalisesti..\cite{RefWorks:17}
Kun jokaiselle solmulle on tiedossa niiden lopullinen sijainti, luodaan lankasegmenttejä siten, että ne liikkuvat solmien koordinaattien välillä.
Poikittaiset segmentit jotka asetetaan tyhjään tilaan rivien $j$ ja $j+1$ välille saavat koordinaatikseen $j+0.5$.
Tämä toistetaan pystysuuntaisille segmenteille.

Langat ryhmitellään lähtöporttien mukaan \emph{hyper}langoiksi, joilla voi olla useita lähteitä.

Jokaiselle lankajoukolle luodaan ne yhdistävä pystysegmentti.

Kaikki samassa ruudussa tai sarakkeessa $k$ olevat segmentit kootaan ryhmäksi joukkoon $S$.
Tavoitteena on levittää ne koordinaateille välillä $[k, k+1]$.

Risteysten minimoimiseksi luodaan segmenttiylitysgraafi jokaiselle ruudulle.
Jokainen ruutuun kuuluva segmentti vastaa yhtä segmenttiylitysgraafin noodia.
Jokaiselle segmenttiparille s1, s2 lasketaan risteysmäärät C1 ja C2. Jos C1 < C2, lisätään reuna segmentin s1 ja s2 välille hintaan C2 - C1. Muussa tapauksessa lisätään lanka s2 ja s1 välille hintaan C1 - C2.

Asyklisen segmenttiylitysgraafin tapauksessa ylitysgraafi voidaan järjestää topologisesti.
Tässä tapauksessa risteysmäärä on vähin mahdollinen.
Ylitysgraafi kuitenkin yleensä sisältää syklejä. Tässä tapauksessa syklit rikotaan, jo tunnetulla tavalla \cite{RefWorks:48}.

Lopulta segmenttien sijoitus lasketaan syklittömästä segmenttiristeysgraafista.
Segmentti jonka sijoitus on $r \in \{1,...,r_{max}\}$ saa koordinaatikseen $k + r/(r_{max} +1)$.
Kun tämä vaihe on suoritettu kaikille poikittaisille segmenteille, sama tehdään kaikille poikittaisille segmenteille.

	\clearpage
	\section{Menetelmät ja esimerkki}

		\subsection{Kaavioiden tuottaminen}

Kaavioiden tuottaminen voidaan toteuttaa suunnittelijan käyttämällä tietokoneella tai keskitetyllä kaaviopalvelimella.
Verkossa sijaitseva kaavioipalvelin soveltuu suurten järjestelmien suunnitteluun erityisen hyvin, kun suunnittelijoita on monta. Kaikki suunnittelijat pystyvät hakemaan keskitetystä suunnittelujärjestelmästä ajantasaisimman version kaaviosta ilman, että kaaviot tarvitsee ladata järjestelmään erikseen.
Lisäksi näin vältytään versioinnin tuottamilta haasteilta - uusi versio asettelualgoritmista voidaan tuoda kaikille suunnittelujärjestelmän käyttäjille yhdenaikaisesti.

Eclipse-projektin päälle rakennettu kokoelma mallipohjaisen suunnittelun apuvälineitä. Sitä kehitetään Kielin yliopistossa.

		\subsection{Esimerkki}

Työssä otettiin esimerkiksi prosessiautomaatiossa tyypillinen säätöventtiili, jota säädetään perustuen virtaussensorin tuottamaan tietoon virtausnopeudesta putkessa. Venttiilin tehtävänä on vakioida putkessa kulkeva virtaus.

Putkeen liittyy useita 

			\subsubsection{Sulkuventtiilin ohjauslogiikka}

Tyypillinen 

			\subsubsection{Sulkuventtiilin lukituskaavio}




	\clearpage
	\section{Tulokset}
	
\emph{(Ei vielä tiedossa.)}

	\section{Yhteenveto ja tulevaisuudennäkymät}

Työssä on osoitettu yhteys suunnattujen graafien ja logiikkadiagrammien välillä sekä suunnattujen graafien asetteluun kehitettyjen algoritmien käyttökelpoisuus teollisuuden automaatiosuunnittelussa.
Työ esitteli logiikkakaavioiden asetteluun soveltuvan algoritmin, joka on muokattavissa erilaisiin teollisuuden tarpeisiin.

Teollisuuden automaatiosuunnittelun yhtenäistämistä on akateemisissa julkaisuissa kartoitettu runsaasti.
Nämä pyrkimykset ovat kuitenkin usein jääneet abstraktille, suunnittelijat vieraannuttavalle tasolle.

Tämä työ on pyrkinyt tarjoamaan konkreettisen ratkaisun konkreettiseen suunnittelutyön ongelmaan, graafinpiirtoon.
Ensisijainen pyrkimys on ollut tuottaa yksinkertaisesti toteutettava ratkaisu joka voidaan helposti integroida suunnitteluprosessiin.

Automaatiojärjestelmien suunnitteluprosessi on monimutkainen, kallis ja pitkä prosessi.
Suunnittelun työvälineisiin kohdistuu suuria vaatimuksia.
Jos menetelmästä saavutettu hyöty ei ole riittävä,

HAASTEET:
Vaikeaa integroida
odottamattomat haasteet
Mitä

Kriteerit:

Tämän kandidaatintyön aikana olen toivottavasti osoittanut että työ on mahdollinen

Lisäksi on esitetty useita syitä sille, miksi ratkaisu on käytännöllinen eli 

On huomattava määrä teknologisia uudistuksia, jotka eivät päädy käyttöön.
Kriteeri, jonka ratkaisun on täytettävä ennen tuotannon aloittamista, on kannattavuus.

Vaikka tuote olisikin mahdollinen, käytännöllinen ja kannattava, täytyy olla vielä viimeinen
Tahto.

\clearpage
\addcontentsline{toc}{section}{Viitteet}

\bibliography{kandi}
%\makeindex
\end{document}