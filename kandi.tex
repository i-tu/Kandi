	\documentclass[finnish,12pt]{article}
	\usepackage{aaltothesis}
	
%       \usepackage[T1]{inputenc}


	%% Use this if you run latex and use eps-format pictures
	%\usepackage[dvips]{graphicx}
	\usepackage[pdftex]{graphicx} 
	\makeindex
	\usepackage[pdfpagemode=None,colorlinks=true,urlcolor=red,linkcolor=blue,
citecolor=black,pdfstartview=FitH]{hyperref}

	%% Use this if you do not like hyperref package - this defines url environment and formats it correctly
	%\usepackage{url}

	% Math stuff
	\usepackage{amsfonts,amssymb,amsbsy}

	\usepackage{setspace}
	\onehalfspacing
	
  \usepackage{lmodern}
	
	% Layout
	\setlength{\hoffset}{-1in}
	\setlength{\oddsidemargin}{35mm}
	\setlength{\evensidemargin}{25mm}
	\setlength{\textwidth}{15cm}
	\setlength{\voffset}{-1in}
	\setlength{\headsep}{7mm}
	\setlength{\headheight}{1em}
	\setlength{\topmargin}{25mm-\headheight-\headsep}
	\setlength{\textheight}{23cm}

	
	\begin{document}
	
	\bibliographystyle{unsrt}

	\university{Aalto-yliopisto}
	\school{Sähkötekniikan korkeakoulu}

	\faculty{Automaatio- ja systeemitekniikan laitos}
	\degreeprogram{Automaatio- ja systeemitekniikka}
	\univdegree{BSc}
	\author{Ian Tuomi}
	\thesistitle{Automaatiokaavioiden generointi}
%	\place{Espoo}
%	\date{5.12.2012}
%	\supervisor{DI Marek Matusiak}
%	\instructor{DI Mika Strömman}
%	\uselogo{red}{!}{tkk}
%	\makecoverpage

	\keywords{Automaatiojärjestelmä, Automatisoitu suunnittelu, ohjelmoitava logiikka, PLC, IEC 61131, FBD, graafinpiirto, suunnattu graafi}
	
	\begin{abstractpage}[finnish]
  
Tämän tutkimuksen kohteena on järjestelmän ohjauslogiikan formaalin kuvauksen
muuntaminen standardeita noudattavaksi logiikkakaavioksi.
  
	\end{abstractpage}

	\newpage
	\vspace{10cm}
	\mysection{Esipuhe}

%Haluan kiittää seuraavia ihmisiä joita ilman en olisi onnistunut tässä työssä.

%Ohjaajaani Mika Strömmania hyvistä huomioista,  asiallisesta palautteesta ja
%skarpista ohjauksesta.

%Kandiryhmäni jäseniä Lauri Vepsäläistä, Heikki 'Taffis' Tahvanaista, Panu
%Kauppista, Peter 'Bembu'  Kronströmiä ja Lauri Andleria.

%Kandikurssin järjestäjää 

%Petri Kokkoa ja Pekka Niemistä ideoinnista ja suunnannäyttämisestä.

%Aalto- yliopiston henkilökuntaa hyvästä työstä.
%Vanhempiani tuesta ja kannustuksesta.

	\vspace{5cm}

Otaniemi, 16.3.2010

	\vspace{5mm}
	{\hfill Ian Tuomi \hspace{1cm}}

	\newpage

%	\addcontentsline{Sisällysluettelo}

	\tableofcontents


%% Käsitteet
	\mysection{Käsitteet}

	\begin{tabular}{ll}
Solmu       & Distributed Control System \\
%	     	      & Hajautettu ohjausjärjestelmä
Lanka        & Distributed Control System \\
%	     	      & Hajautettu ohjausjärjestelmä
	\end{tabular}

%% Lyhenteet
	\mysection{Lyhenteet}

	\begin{tabular}{ll}
DCS        & Distributed Control System \\
%	     & Hajautettu ohjausjärjestelmä
%FBD         & Function Block Diagram, IEC 61131-3 -standardin määrittelemä logiikkaohjelmointikieli
%IEC          & International Electrotechnical Commission
%PLC         & Programmable Logic Circuit \\
%	      & Ohjelmoitava logiikkapiiri

	\end{tabular}

	\cleardoublepage
	\storeinipagenumber
	\pagenumbering{arabic}
	\setcounter{page}{1}

% Kandi %

	\section{Johdanto}
	\thispagestyle{empty}

Teollisen automaatiojärjestelmän suunnittelutyön tulos koostuu suuresta määrästä erilaisia dokumentteja.
Laajan järjestelmän tapauksessa kyse voi olla jopa tuhansista yksittäisistä kaavioista, asettelukuvista ja listauksista.
Ne yhdessä muodostavat kuvauksen, joka mahdollistaa järjestelmän toteutuksen, käyttöönoton ja ylläpidon.
Dokumentaation laatiminen käsin on suurissa projekteissa työlästä ja tehotonta.
Nykyaikaisessa automaatio- ja instrumentointisuunnittelussa ongelma korostuu.
Ratkaisuista on tullut monimutkaisempia ja laatu- ja joustavuusvaatimukset ovat lisääntyneet.
Lisäksi vaaditut toteutusajat ovat jatkuvasti lyhentyneet.
\cite{RefWorks:41}

Suunnitteluprosessiin kohdistuneista vaatimuksesta johtuen työtä on pyritty tehostamaan automatisoiduilla apuvälineillä.
Alan metodiikka ei ole ilmeisistä standardoimiseduista huolimatta yhtenäistynyt ja yhteistyö alan tutkimuksessa on vähäistä.
Vaikka lähestymistavat ovat vaihtelevia, alalla on kuitenkin nähtävissä yhtenäinen siirtymä kohti jaettuja tietomalleja.

Automaatiojärjestelmien suunnittelun näkökulmasta jaettujen tietomallien käyttö tarkoittaa,
että suunnittelujärjestelmään tallentuu projektin edetessä kaikki sähköistys ja instrumentointi automaatiojärjestelmineen ja kenttälaitteineen.
Erilaiset kaaviot voidaan tuottaa suoraan tietomallin sisältävästä tietokannasta.

Tietomalliin perustuva lähestymistapa vaatii sen laajuuden ja rajoitukset määrittelevän metamallin.
Se ohjaa ja määrittää suunnittelun kohteen lisäksi myös yleisesti suunnittelutöiden kulkua.

Tämän tutkimuksen kohteena on hajautetun ohjausjärjestelmän logiikan tietomallin muuntaminen standardeja noudattavaksi kaavioksi.
Logiikkakaavio on tapa pelkistää järjestelmän eri osien syöttöjen ja lähtöjen välillä vallitseva logiikka visuaaliseen ja helposti ymmärrettävään muotoon.
Se on määritelty yksiselitteisesti ja on tulkittavissa suunnatuksi graafiksi, jolloin algoritmillisen graafinpiirron tuloksia voidaan hyödyntää.

Algoritmillinen graafipiirto on perusteellisesti tutkittu ala, jonka tuloksia voidaan käyttää kaikenlaisten suunnattujen kaavioiden piirtoon.
Työssä esitellään Sugiyaman ym. \cite{RefWorks:9} esittämään hierarkiseen lähestymistapaan perustuva, tietovirtakaavioiden esittämiseen soveltuva algoritmi.

Esimerkki tyypillisestä teollisuuden logiikkakaaviosta esitellään ja se asetellaan se käyttäen esiteltyä algoritmia.
Lisäksi pohditaan miten työn menetelmät voitaisiin toteuttaa laajemmalla mittakaavalla.

	\clearpage
	\section{Tehtaan mallit}

Tehdasmalli on kuvaus, joka mahdollistaa tehtaan toteutuksen, käyttöönoton ja ylläpidon. Se on tietomalli, joka kuvaa tehtaan toimintaa, sen prosessia, organisaatiota, ihmisiä ja näitten aktiviteetteja.
Pohjimmiltaan se koostuu tehdasobjekteista ominaisuuksineen sekä niiden välisistä relaatioista. \cite{RefWorks:41}

Suunnittelijoilla on työtehtävistään riippuen erilaisia tarpeita tehdasmallin suhteen.
Työn kohde on monitahoinen eikä mikään yksi malli pysty kattamaan kaikkia suunniteltavan järjestelmän näkymiä.
Tehdasta tulee kuvata useilta eri näkökannoilta erilaisilla tarkkuuksilla kunkin näkymän vaatimuksien mukaisesti.
Tehdasmalliin kuuluu siis useita malleja, jotka yhdessä muodostavat kokonaismallin.

Jokaisella mallilla on myös metamalli. Se määrittelee millaisia objekteja malli voi sisältää, mitä ominaisuuksia sillä voi tai täytyy olla ja millaisia yhteyksiä objektien välillä on.
Metamallin loogiset riippuvuudet määrittelevät suunnittelun työtapoja ja järjestystä.
Ne kuvaavat millaiset tietomallit ovat suunnittelujärjestelmän kannalta hyväksyttäviä tehdasmalleja ja
määräävät sen laajuuden. Metamallin määritteleminen tekee työn tuloksesta ennakoitavan ja mahdollistaa tehokkaiden apuvälineiden kehittämisen.
Määrittelyllä myös suljetaan pois eriäviä tapoja kuvata tehdasta ja mahdollistetaan määrittelyyn perustuvat työkalut ja suunnittelukäytännöt.
Tällaisia ovat esimerkiksi uudelleenkäytettävää koodia sisältävät kirjastot ja erilaiset mallimuunnokset.

Suunnittelussa käytettävät metamallit valitaan siten, etteivät ne ole ristiriidassa ja muodostavat yhdessä toisiaan täydentävän kokonaisuuden.
Tällöin metamallien konfiguraatio muodostaa itsessään mallin.


	\subsection{Automaatiojärjestelmän näkymät}

Teollisuuden hajautettujen ohjausjärjestelmien suunnittelussa on havaittu
tarpeelliseksi ainakin kolme näkymää: funktionaalinen, fyysinen sekä ohjelmistollinen \cite{RefWorks:38}.


		\subsubsection{Funktionaalinen näkymä}

Funktionaalinen näkymä määrittelee säätöjärjestelmän toiminnan tavalla, joka toteutettuna täyttää sille asetetut vaatimukset.
Se on formaali spesifikaatio eli kuvaus ohjelmistosta tai laitteistosta, joka voidaan sen avulla toteuttaa
 Se kuvaa mitä järjestelmän tulisi tehdä, muttei välttämättä kuinka järjestelmän tulisi se toteuttaa.

Tätä näkymää määritettäessä voivat eri alojen suunnittelijat osallistua työhön ilman
tuntemusta instrumentoinnista tai ohjelmistokehityksestä. Kun päätökset on tehty
abstraktilla tasolla, voidaan hankinnat räätälöidä sen mukaisesti ja tulos
toteuttaa tehokkaasti.

Tällaisen määrittelyn avulla on mahdollista käyttää formaaleja verifiointimenetelmiä joitten avulla
voidaan osoittaa, että järjestelmän suunnitelma toteuttaa sille asetetut vaatimukset.
Näin suunnitelman oikeellisuus voidaan osoittaa ennen mittavia investointeja toteutukseen.
Funktionaalisen näkymän suunnitteluprosessin tuloksena on usein
PI-kaavio joka tyypillisesti toimii esisuunnittelutietona muille näkymille.


		\subsubsection{Fyysinen näkymä}

Fyysiseen näkymään suunnitellaan järjestelmän johdotukset, kaapelit, kenttäväylät,
ohjauskeskukset, toimilaitteiden sijainnit sekä ylipäänsä kaikki mitä vaaditaan 
järjestelmän fyysiseen käyttöönottoon.

\emph{Tarvitaanko lisää?}


		\subsubsection{Ohjelmistonäkymä}

Ohjelmistonäkymä kattaa funktionaalisen suunnittelun toteutuksen ohjelmamuodossa.
Asiakkaalla on yleensä omat toiveensa sen suhteen, millaiseen muotoon ohjelma tehdään.
Ohjelmiston toteuttamiseen ei pitäisi liittyä enää suunnittelutyötä - toisin sanoen funktionaalisen näkymän määrittelyjen täytyy olla riittävän tarkkoja jotta niitten mukaan tehdyssä ohjelmassa ei ole sen toimintaan vaikuttavia tulkinnanvaraisuuksia.
Ohjelmistototeutuksen työtavat jäävät usein määrittelemättömiksi ja muusta suunnittelutyöstä irrallisiksi,
vaikka pyrkimyksiä toteutustapojen nitten integroimiseksi suunnitteluprosessiin entistä vahvemmin on ollut.
Toteutustapa jää yksittäisten suunnittelijoiden määriteltäväksi, mistä seuraa että yhtenäistä työtapaa harvoin on.
Toteutetun ohjelmakoodin uudelleenkäyttö jää myös tyypillisesti vähäiselle asteelle.


	\subsection{Logiikan kuvaukset}

Logiikan kuvaukset helpottavat tehtaan toiminnan ymmärrystä suunnittelu- ja rakennusvaiheen lisäksi tehtaan ylläpidon ja huollon yhteydessä ja
ovat siksi tärkeä osa tehtaan lopullista dokumentaatiota.

Loogista järjestelmää voidaan kuvata monin erilaisin tavoin.
Nämä erilaiset kuvaukset voivat näyttää erilaisilta, mutta olla silti täysin yksiselitteisiä suhteessa kuvattuun järjestelmään.
Tämä tarkoittaa, että kuvaukset sisältävät samat tiedot eri muodoissa.

Teollisessa automaatiosuunnittelussa sallitut logiikan esitystavat on määritelty erityisesti selkeyttä, turvallisuutta ja ennustettavaa toimintaa silmälläpitäen.
Syöttöjen ja lähtöjen välistä logiikkaa esittävät kaaviot ovat yleisiä.
Määrittelyn mukaisia kaavioita ei kuitenkaan ole välttämättä käytännönläheistä laatia.
Kun kaavioista tulee monimutkaisia, kuluu niitten esteettiseen asetteluun huomattavan paljon aikaa. \emph{[lähde on, pitää kaivaa]}
Jos tietokoneen avulla toteutettava algoritmillinen muunnos toisenlaisesta kuvauksesta lopulliseen kaaviomuotoon onnistuu ilman suunnittelijalle siitä koituvaa vaivaa tai aikaa,
kannattaa suunnittelijan laatia kahdesta kuvaustyypistä helpompi ja antaa algoritmin hoitaa lopullisen kuvauksen laatiminen.
Näin laaditut kaaviot voivat olla jopa parempia kuin käsintehdyt  \emph{[lähde on, pitää kaivaa]}


		\subsubsection{Toimintakaaviot}

Toimintakaavio on funktionaalisen näkymän toteutus, joka tavallisesti valmistellaan järjestelmän suunnittelun varhaisessa vaiheessa prosessikaaviosta.
Se määrittelee ohjausjärjestelmän toiminnot ja sitä pidetään ajantasaisena järjestelmän suunnittelun edetessä.
Se toimii suunnittelun apuna ja on lopulta osa lopullisen järjestelmän ohjeistusta.


		\subsubsection{Ohjelmakoodi}

IEC~61131-3 on laajassa käytössä oleva avoin standardi joka määrittelee automaatiologiikan ohjelmointimenetelmät ja  pyrkii olemaan riittävän joustava mihin tahansa tarkoitukseen.
Se sisältää viisi erilaista ohjelmointikieltä \emph{(muuntaminen koodityypistä toiseksi?)}, joista tässä työssä käsitellään erityisesti FBD:tä.

Suunnitteluohjelmistojen valmistajat myös jättävät usein standardinmukaiseksi kutsutuista ohjelmistoista standardin ominaisuuksia toteuttamatta.\cite{RefWorks:42}
Tämä johtuu standardinmukaisuuden määritelmästä: ohjelma on standardinmukainen, jos se toteuttaa standardista osan, ja mainitsee mitä se jättää toteuttamatta. 

Automaatiokaavioiden suoritusjärjestys etenee standardin IEC 61131-3 mukaan
vasemmalta oikealle. Lisäksi toimilohkoa ei ajeta ennen kuin kaikki sitä edeltävät toimilohkot on suoritettu.
Keskinäisen suoritusjärjestyksen täytyy myös tulla esille toteuttavassa ohjelmistossa.
Suoritusjärjestys kulkee usein ylhäältä alas, mutta tätä ei voi olettaa aina todeksi.

Suoritusjärjestysvaatimus asettaa seuraavassa kappaleessa tarkasteltavalle graafinpiirrolle rajoituksia.
Jos niitä ei oteta huomioon, saattaa graafin algoritmillinen piirto johtaa vääränlaiseen kaavioon.
Mahdollisten takaisinkytkentöjen tapauksessa vaaditaan huolellisuutta, jottei syklien poistovaiheessa kaavion järjestys muutu.

Toimilohkot kuvaavat toisistaan erillisiä itsenäisiä laskennallisia yksiköitä
ja niitten relaatioita toisiinsa. Toimilohko voi tilastaan riippuen lähettää
tapahtumia jotka vaikuttavat muitten blokkien toimintaan. Sen tekemien
laskutoimitusten tulos riippuu sen vasemmalta puolelta tulevista
syöttötiedoista ja sen suorittaman laskennan tulokset lähetetään blokin oikealta puolelta.
Toisiinsa liitetyt funktioblokit muodostavat verkon, joka määrittelee laajemman toiminnallisuuden.


		\subsubsection{Logiikan tietokantakuvaukset}

Suunniteltu logiikka tallennetaan jaettuun suunnittelumalliin, johon kaikilla järjestelmän suunnittelijoilla on yhteys.
Tapa jolla logiikka tallennetaan täytyy olla yhdenmukainen, jotta suunnittelutyössä voidaan tehdä tehokasta yhteistyötä työpaikalla jaettujen yhtenäisten suunnittelun apuvälineiden avulla.
Lisäksi kuvauksen tulee olla formaali jotta logiikkaa voitaisiin käsitellä algoritmillisesti.
Formaalilla tarkoitetaan tietynlaista, tarkkaan määritetyn syntaksin mukaista kuvausta.
Tällöin tulee myös mahdolliseksi toteuttaa helposti tietoa käsitteleviä muunnosalgoritmeja.
Muunnoksella tarkoitetaan jonkin tiedon kuvauksen muuttamista toiseksi kuvaukseksi.

Standardin IEC 61131-3 mukaisten ohjelmointikielten kuvaamiseksi on ehdotettu PLCopen-standardia.

PLCopen -standardin mukainen logiikan XML-esitys voi sisältää toimilohkon toiminnallisuuden kannalta välttämättömien asioiden lisäksi toimilohkon sijainnin, koon ja jopa lankojen reititykset.
PLCopen -standardin mukainen esitys voidaan tällöin laatia siten, että se on tuotettavan kaavion asettelun kannalta täysin yksiselitteinen.

Tällaista esitystä voidaan silloin pitää dokumentaation lopullisena muotona.


Kun logiikkakuvauksen muoto on määritelty tarkasti, voidaan määritelmän mukaisesti laadittu logiikkakuvaus muuntaa määritelmään nojaavien sääntöjen perusteella.
Monet automaatiologiikan suunnitteluohjelmistot pystyvät muuntamaan käyttämänsä kuvauksen PLCopen-muotoiseksi tiedoksi, jolloin suunnittelutietoa voidaan siirtää eri järjestelmien kesken.



	\clearpage
	\section{Hierarkinen graafinpiirto}
	
% http://www.cs.brown.edu/~rt/gdhandbook/

Suunnattujen graafien piirtämiseen käytettävän kerrostetun menetelmän
esittivät Sugiyama et. al vuonna 1981 \cite{RefWorks:9}.

Suunnattujen graafien kerrostaminen siten, että noodien langat osoittavat järjestyksessä seuraavaan kerrokseen,
on osoittautunut luontevaksi tavaksi esittää tietovirtoja. Sugiyaman lähestymistapaa ei kuitenkaan voi käyttää sellaisenaan tietovirtakaavioiden kuvaamiseen. Aseteltavissa tietovirroissa esiintyvät noodit sisältävät useita portteja, joiden keskinäisellä järjestyksellä on merkitystä. Lisäksi Sugiyaman lähestymistavassa langat eivät ole nykyisen käytännön mukaan ortogonaalisia, jolloin tarvitaan erillinen reititysalgoritmi.

Kerrostamista seuraa noodien keskinäisen järjestyksen määrittely ja mahdollisesti lankojen reititys

Työvaiheista kerrostus ja risteyksien vähennysvaihe saattavat muuttaa suoritusjärjestystä.
Tällöin algoritmin toimintaa pitää yksinkertaisesti rajoittaa järjestysherkkien blokkien osalta.
Koska algoritmit ovat heuristisia, ovat siihen tehtävät yksinkertaiset rajoitukset helppoja toteuttaa.

Koska aseteltavat graafit sisältävät useita portteja ja lankoja, täytyy tämä ottaa huomioon. Porttirajoitteisten noodien

"Improved layout for Data Flow Diagrams with Port Constraints"
\begin{itemize}
  \item Gansner et. al: Noodien asettelualgoritmeja voi mukauttaa toimimaan porttirajoitteisten noodien asettelussa
  \item Sander: Sander esitti väliaikaisnoodien lisäämisen lankojen reitittämiseksi
  \item Risteysvähentämistä porttirajoitteilla tutki Waddle, joka otti käyttöön noodien porttijärjestyksen huomioivan järjestelyheuristiikan.
\end{itemize}

Nämä lähestymistavat eivät tue porttirajoitteita joten ne eivät ole riittäviä datavirtauskaavioiden asetteluun.

Työssä käytetty algoritmi seuraa Klauske et. al. kehittämää  datavirtauskaavioiden rajoitukset huomioon ottavaa lähestymistapaa \cite{RefWorks:50} joka yhdistelee useita sopivia graafinpiirron menetelmiä.

Se koostuu viidestä vaiheesta:
\begin{enumerate}
  \item Syklien poisto, seuraa Eades et al.\cite{RefWorks:48}
  \item Kerrostus, seuraa Gansner et. al., lankapituuden minimimoivaa menetelmää. \cite{RefWorks:28}
  \item Järjestely, seuraa Sugiyama et. al alkuperäistä menetelmää. \cite{RefWorks:9}
  \item Poikittaisasettelu, seuraa Sanderin lineaaristen segmenttien menetelmää. \cite{RefWorks:49}
  \item Lankareititys, seuraa Sanderin monilankareititysalgoritmia. \cite{RefWorks:17}
\end{enumerate}

		\subsection{Syklien poisto}

Syklinpoistovaiheessa muotoillaan graafi siten, että se on syklitön.
Syklittömyys tarkoittaa sitä että mihinkään noodiin ei voi palata seuraamalla siitä suunnattuja lankoja.
Säätötekniikassa yleiset takaisinkytkennät ovat esimerkkejä sykleistä.

Syklejä ei voida asettelualgoritmin syklittömyysvaatimuksesta huolimatta poistaa.
Tämän vuoksi syklit rikotaan kääntämällä yksi syklin sisältämistä langoista.
Tätä jatketaan kunnes graafi on asyklinen.
Syklillisen graafin muuntaminen syklittömäksi, eli käännettävien lankojen valinta siten että niitä on mahdollisimmanvähän on NP-vaikea.

Syklien poistovaiheessa käsiteltävä tietomalli kuitenkin sisältää syklipoistoa helpottavaa tietoa, nimittäin jokaisessa puussa ensimmäisenä suoritettavan noodin. Tämä merkittävästi helpottaa syklinpoistovaihetta, ja graafin suuntaamisesta tuleekin triviaali toimenpide. [?]

Käännetyt langat käännetään lankojen reitittämisvaiheessa takaisin oikein päin.
Kun graafissa ei ole syklejä, voidaan määritellä noodien keskinäinen topologinen kerrostus.

		\subsection{Kerrostus}

Kerrostusvaiheessa ratkaistava vähimmäisongelma on, että noodin seuraajanoodin täytyy olla suurempaa kerroslukua kuin mitä se itse on. Poikkeuksena tästä on kun noodi kytkeytyy itseensä.

Kerrostetuksen graafin tulee myös olla kompakti. Tämä tarkoittaa että sen leveys ja pituus ovat pieniä ja kerrosten välinen etäisyys on vakio. 
Käytännössä rajoituksena toimii tarkastelutavasta riippuen näyttöpääte tai paperi, jolta graafia on tarkoitus tarkastella.

Graafin pituuden alaraja on sen sisältämän pisimmän yhtenäisen ketjun pituus. Tarkastelemalla tätä pituutta saadaan kuva lopullisen kuvan leveydestä.

Erilaisilla kerrostusmenetelmillä graafin pituus voidaan minimoida leveyden kustannuksella tai siitä voidaan tehdä mahdollisimman kapea pituuden kustannuksella.

Sekä leveyden että pituuden minimointi samanaikaisesti on rinnastettavissa multiprosessoriajastusongelmaan ja on siten NP-täydellinen ongelma. \cite{RefWorks:39}
Multiprosessoriongelmaa varten suunniteltu algoritmi, Coffman-Graham-kerrostusmenetelmä tarjoaa tällöin ratkaisun tähän ongelmaan.

		\subsection{Risteyksien vähentäminen}

Lankojen risteysten määrä on osoittautunut olemaan suurin yksittäinen tekijä graafin luettavuuden kannalta. \cite{RefWorks:47}
Risteysmäärän vähentäminen on tällöin mille tahansa luettavuutteen tähtäävälle asettelualgoritmille tärkeä tavoite.

Graafin kokonaisristeysmäärän vähentäminen ei perustu solmujen tarkkoihin sijainteihin, vaan niitten keskinäiseen järjestykseen. Tämä tarkoittaa sitä, että ongelma on luonteeltaan kombinatorinen eikä geometrinen, mikä huomattavasti yksinkertaistaa hyvän ratkaisun löytämistä.
Tästä helpotuksesta huolimatta kyseessä on NP-täydellinen ongelma siinäkin tapauksessa että kerroksia on vain kaksi. \cite{RefWorks:40}

Lähestymistapoja risteyksien vähentämiseen on vierekkäisten noodien paikkojen
vaihtelu keskenään sekä mediaanimenetelmä, jossa noodi asetetaan paikalle, joka
on siihen yhtyneiden solmujen puolivälissä.

%Tähän se väikkäri myös! (P. Eades, ”Heuristics for Reducing crossings in
%2-layered networks”, E. Mäkinen, ”experiments of drawing 2-level hierarchical
%graphs”, M. Jünger, ”2-layer straightline crossing minimization: Perf…” )

Erilaisten järjestelyalgoritmien tutkimus ei ole tuottanut yhtä selkeästi parasta menetelmää.
Sen sijaan parhaat tulokset on saavutettu menetelmiä yhdistelevillä heuristisilla hybridialgoritmiksi. [?]

Tässä menetelmässä [?] solmut uudelleenjärjestetään joka iteraation yhteydessä mediaanimenetelmällä.
Sen jälkeen luodaan joukko lähes identtisiä järjestelyitä joissa esiintyy paikallisia transpositioita.
Lopulta valitaan paras tulos seuraavaa iteraatiota varten.
Tätä lähestymistapaa voisi luonnehtia geneettiseksi algoritmiksi.

%Optimizing Automatic Layout for Data Flow Diagrams, 2011, Diploma thesis,
%Christian-Albrechts-Universität zu Kiel, Department of Computer Science

		\subsection{Poikittainen asettelu}

Jokainen kulma langassa aiheuttaa ylimääräisen rasitteen ihmisen hahmotuskyvylle. \cite{RefWorks:47}
Asettelualgoritmin tulee tällöin pyrkiä minimoimaan lankojen kulmat.
Siinä missä noodikerroksien noodikombinaatiot vaikuttavat lankojen risteysten määrään, vaikuttaa niiden tarkka poikittainen asettelu langoissa olevien kulmien määrään.
Solmujen poikittaisen asettelun avulla solmujen välisten lankojen käännösten määrää pyritään vähentämään jotta kaavion luettavuus paranee.
Asettelun merkitys korostuu kun lankoja on paljon, kuten automaatiologiikkakaaviolle on tyypillistä.

Risteysten vähentämisvaiheessa saavutettu kombinatorinen ratkaisu säilytetään poikittaisasetteluvaiheessa.

		\subsection{Lankojen reititys}

Insinöörialojen logiikkakaavioiden langat on reititetty ortogonaalisesti.

Sanderin ratkaisu sijoittaa noodit aluksi ruudukolle. Lopullisen luettavuuden parantamiseksi ruudukko hävitetään. Ruudukkoesitys mahdollistaa monta kerrosta ylittävien lankojen reitittämisen helposti ilman kulmia langoissa.
\cite{RefWorks:17}

Jokaista lankajoukkoa kohden luodaan pystysuuntainen runkolanka.

Ruudukon samassa ruudussa olevat langat ryhmitellään omaan joukkoonsa.
Ne pyritään sitten jakamaan ruutuun koordinaattien k ja k+1 välille.
Risteysten minimoimiseksi luodaan segmenttiylitysgraafi jokaiselle ruudulle. Jokainen ruutuun kuuluva segmentti vastaa yhtä segmenttiylitysgraafin noodia. Jokaiselle segmenttiparille s1, s2 lasketaan risteysmäärät C1 ja C2. Jos C1 < C2, lisätään reuna segmentin s1 ja s2 välille hintaan C2 - C1. Muussa tapauksessa lisätään lanka s2 ja s1 välille hintaan C1 - C2.

Asyklisen segmenttiylitysgraafin tapauksessa ylitysgraafi voidaan järjestää topologisesti. Tässä tapauksessa risteysmäärä on vähin mahdollinen. Ylitysgraafi kuitenkin yleensä sisältää risteyksiä. Tässä tapauksessa.

	\clearpage
	\section{Menetelmät ja esimerkki}

		\subsection{Kaavioiden tuottaminen}

Kaavioiden tuottaminen voidaan toteuttaa suunnittelijan käyttämällä tietokoneella tai keskitetyllä kaaviopalvelimella.
Verkossa sijaitseva kaavioipalvelin soveltuu suurten järjestelmien suunnitteluun erityisen hyvin, kun suunnittelijoita on monta. Kaikki suunnittelijat pystyvät hakemaan keskitetystä suunnittelujärjestelmästä ajantasaisimman version kaaviosta ilman, että kaaviot tarvitsee ladata järjestelmään erikseen.
Lisäksi näin vältytään versioinnin tuottamilta haasteilta - uusi versio asettelualgoritmista voidaan tuoda kaikille suunnittelujärjestelmän käyttäjille yhdenaikaisesti.

		\subsection{Vertaillut vaihtoehdot (tarpeellisuus?) }

Funktioblokkien editointiin on olemassa useita työkaluja:
\begin{description}
	\item[FBDK] Rockwell Automationin ilmainen funktioblokkieditori, FBDK on akateemisessa tutkimuksessa laajassa käytössä. FBDK ei kuitenkaan tarjoa tapoja muuttaa kaavion asettelua algoritmillisesti.
	\item[FBench] FBench on avoimen lähdekoodin standardimukainen ohjelmisto, joka kuitenkin kärsii samoista puutteista kuin FBDK.
	\item[4DIAC] PROFACTORin kehittämä 4DIAC tarjoaa standardeja noudattavan funktioblokkieditorin. Se ei kuitenkaan mahdollista blokkien välisten lankojen reitittämistä. 
	\item[ISaGRAF ja NxtControl] ovat kaupallisesti tuotettuja ohjelmistoja joita ei valitettavasti voitu työtä varten arvioida.
\end{description}

			\subsubsection{KIELER}

Piirtoalgoritmiksi valitun algoritmin koonneet ovat myös toteuttaneet kyseisen algoritmin osan KIELER-projektia.
KIELER rakentuu [?] Eclipse-projektin päälle. Se pyrkii sisällyttämään itseensä olennaisilta osilta riittävän määrän algoritmeja mallipohjaisen suunnittelun apuvälineiksi.

		\subsection{Tulosten arviointiperusteet}

Graafien luettavuutta on pyritty kartoittamaan. \cite{RefWorks:47}
(tähän myös "The Aesthetics of Graph Visualization"?)

Tärkeimmät ominaisuudet järjestyksessä Purchase et. al. mukaan: 
\begin{enumerate}
  \item Lankojen risteysmäärä
  \item jne. (kesken)
\end{enumerate}

	\clearpage
	\section{Tulokset}
	
(Ei vielä tiedossa.)

	\section{Yhteenveto ja tulevaisuudennäkymät}

Työssä on osoitettu yhteys suunnattujen graafien ja logiikkadiagrammien välillä sekä suunnattujen graafien asetteluun kehitettyjen algoritmien käyttökelpoisuus teollisuuden automaatiosuunnittelussa.
Työ esitteli logiikkakaavioiden asetteluun soveltuvan algoritmin, joka on muokattavissa esitetyn esimerkin lisäksi erilaisiin teollisuuden tarpeisiin.

Teollisuuden automaatiosuunnittelun yhtenäistämistä on akateemisissa julkaisuissa kartoitettu runsaasti.
Nämä pyrkimykset ovat kuitenkin usein jääneet abstraktille, suunnittelijat vieraannuttavalle tasolle.

Tämä työ on pyrkinyt tarjoamaan konkreettisen ratkaisun konkreettiseen suunnittelutyön ongelmaan, graafinpiirtoon.
Ensisijainen pyrkimys on ollut tuottaa yksinkertaisesti toteutettava ratkaisu joka voidaan helposti integroida suunnitteluprosessiin.

\clearpage
\addcontentsline{toc}{section}{Viitteet}

\bibliography{kandi}
%\makeindex
\end{document}