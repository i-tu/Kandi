e	\documentclass[finnish,12pt]{article}
	\usepackage{aaltothesis}
	
%       \usepackage[T1]{inputenc}


	%% Use this if you run latex and use eps-format pictures
	%\usepackage[dvips]{graphicx}
	\usepackage[pdftex]{graphicx} 
	\makeindex
	\usepackage[pdfpagemode=None,colorlinks=true,urlcolor=red,linkcolor=blue,
citecolor=black,pdfstartview=FitH]{hyperref}

	%% Use this if you do not like hyperref package - this defines url environment and formats it correctly
	%\usepackage{url}

	% Math stuff
	\usepackage{amsfonts,amssymb,amsbsy}

	\usepackage{setspace}
	\onehalfspacing
	
  \usepackage{lmodern}
	
	% Layout
	\setlength{\hoffset}{-1in}
	\setlength{\oddsidemargin}{35mm}
	\setlength{\evensidemargin}{25mm}
	\setlength{\textwidth}{15cm}
	\setlength{\voffset}{-1in}
	\setlength{\headsep}{7mm}
	\setlength{\headheight}{1em}
	\setlength{\topmargin}{25mm-\headheight-\headsep}
	\setlength{\textheight}{23cm}

	
	\begin{document}
	
	\bibliographystyle{unsrt}

	\university{Aalto-yliopisto}
	\school{Sähkötekniikan korkeakoulu}

	\faculty{Automaatio- ja systeemitekniikan laitos}
	\degreeprogram{Automaatio- ja systeemitekniikka}
	\univdegree{BSc}
	\author{Ian Tuomi}
	\thesistitle{Automaatiokaavioiden generointi}
%	\place{Espoo}
%	\date{5.12.2012}
%	\supervisor{DI Marek Matusiak}
%	\instructor{DI Mika Strömman}
%	\uselogo{red}{!}{tkk}
%	\makecoverpage

	\keywords{Automaatiojärjestelmä, Automatisoitu suunnittelu, ohjelmoitava logiikka, PLC, IEC 61131, FBD, graafinpiirto, suunnattu graafi}
	
	\begin{abstractpage}[finnish]
  
Tämän tutkimuksen kohteena on järjestelmän ohjauslogiikan formaalin kuvauksen
muuntaminen standardeita noudattavaksi logiikkakaavioksi.
  
	\end{abstractpage}

	\newpage
	\vspace{10cm}
	\mysection{Esipuhe}

%Haluan kiittää seuraavia ihmisiä joita ilman en olisi onnistunut tässä työssä.

%Ohjaajaani Mika Strömmania hyvistä huomioista,  asiallisesta palautteesta ja
%skarpista ohjauksesta.

%Kandiryhmäni jäseniä Lauri Vepsäläistä, Heikki 'Taffis' Tahvanaista, Panu
%Kauppista, Peter 'Bembu'  Kronströmiä ja Lauri Andleria.

%Kandikurssin järjestäjää 

%Petri Kokkoa ja Pekka Niemistä ideoinnista ja suunnannäyttämisestä.

%Aalto- yliopiston henkilökuntaa hyvästä työstä.
%Vanhempiani tuesta ja kannustuksesta.

	\vspace{5cm}

Otaniemi, 16.3.2010

	\vspace{5mm}
	{\hfill Ian Tuomi \hspace{1cm}}

	\newpage

%	\addcontentsline{Sisällysluettelo}

	\tableofcontents


%% Käsitteet
	\mysection{Käsitteet}

	\begin{tabular}{ll}
Solmu       & Distributed Control System \\
%	     	      & Hajautettu ohjausjärjestelmä
Lanka        & Distributed Control System \\
%	     	      & Hajautettu ohjausjärjestelmä
	\end{tabular}

%% Lyhenteet
	\mysection{Lyhenteet}

	\begin{tabular}{ll}
DCS        & Distributed Control System \\
%	     & Hajautettu ohjausjärjestelmä
%FBD         & Function Block Diagram, IEC 61131-3 -standardin määrittelemä logiikkaohjelmointikieli
%IEC          & Internation Electrotechnical Commission
%PLC         & Programmable Logic Circuit \\
%	      & Ohjelmoitava logiikkapiiri

	\end{tabular}

	\cleardoublepage
	\storeinipagenumber
	\pagenumbering{arabic}
	\setcounter{page}{1}

%% KANDI BEGINNETH
	\section{Johdanto}
	\thispagestyle{empty}

Teollisuuden automaatiojärjestelmän suunnittelutyön tulos koostuu kaavioista -
laajan järjestelmän tapauksessa jopa tuhansista sellaisista. Kaaviot muodostavat
kuvauksen joka mahdollistaa tehtaan toteutuksen, käyttöönoton ja ylläpidon.
Kaavioiden piirtäminen käsin on suurissa projekteissa työlästä ja tehotonta.
Nykyaikaisessa tehdassuunnittelussa ongelma korostuu. Ratkaisuista on tullut
monimutkaisempia ja laatu- ja joustavuusvaatimukset ovat kasvaneet. Lisäksi
suunnitteluprojektien toteutusaikavaatimukset ovat jatkuvasti lyhentyneet.
\cite{RefWorks:41}

Tämän vuoksi suunnitteluprosessia on pyritty tehostamaan automatisoiduilla
suunnittelun apuvälineillä. Suunnittelumetodiikat eivät ole
ilmeisistä standardoimiseduista huolimatta yhtenäistyneet, ja yhteistyö alan
tutkimuksessa on vähäistä. Vaikka lähestymistavat ovat vaihtelevia, on
tehdassuunnittelussa kuitenkin nähtävissä yhtenäinen siirtymä kohti 
tietomalleja. Automaatiosuunnittelun kannalta tämä tarkoittaa sitä, että
suunnittelujärjestelmään syntyy projektin edetessä tehtaan
tietomalli johon tehtaan kaikki sähköistys ja instrumentointi
automaatiojärjestelmineen ja kenttälaitteineen on merkitty. Erilaiset kaaviot
voidaan tuottaa suoraan tietomallin sisältävästä tietokannasta.

Tietomalliin perustuva lähestymistapa vaatii tietomallin laajuuden ja rajoitukset
määrittelevän metamallin. Tämä malli ohjaa ja määrittää suunnittelun kohteen lisäksi
myös yleisesti suunnittelutöiden kulkua.

Tämän tutkimuksen kohteena on hajautetun ohjausjärjestelmän logiikan
tietomallin muuntaminen standardeja noudattavaksi logiikkakaavioksi.
Logiikkakaaviot ovat tapa pelkistää syöttöjen ja lähtöjen välillä vallitseva
logiikka. Logiikkakaavio on määritelty yksiselitteisesti ja on tulkittavissa
suunnatuksi graafiksi, jolloin algoritmillisen graafinpiirron tuloksia voidaan
hyödyntää.

Algoritmillinen graafipiirto on perusteellisesti tutkittu ala, jonka tuloksia
voidaan käyttää kaikenlaisten suunnattujen kaavioiden piirtoon. Työssä esitellään
Sugiyaman et. al. \cite{RefWorks:9} esittämään hierarkiseen lähestymistapaan
perustuvan algoritmin jonka avulla lopullinen kaavio piirretään.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	\clearpage
	\section{Tehtaan mallit ja mallinnustavat}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Tehdasmalli on kuvaus, joka mahdollistaa tehtaan toteutuksen, käyttöönoton ja
ylläpidon. Se on tietomalli, joka kuvaa laajuudestaan riippuen tehtaan toimintaa,
sen prosessia, organisaatiota, ihmisiä ja näitten aktiviteetteja. Tehdasmalli
koostuu pohjimmiltaan tehdasobjekteista, niiden ominaisuuksista ja niiden
välisistä relaatioista. \cite{RefWorks:41}

Suunnittelijoilla on työtehtävistään riippuen erilaisia tarpeita tehdasmallin
suhteen. Työn kohde on monitahoinen eikä mikään yksi malli pysty kattamaan
kaikkia suunniteltavan järjestelmän näkymiä. Tehdasta tulee kuvata useilta eri
näkökannoilta erilaisilla tarkkuuksilla kunkin näkymän vaatimuksien mukaisesti.
Tehdasmalliin kuuluu siis useita malleja, jotka yhdessä muodostavat kokonaisen
systeemin.

Jokaisella mallilla on myös metamalli joka määrittelee millaisia objekteja malli
voi sisältää, mitä ominaisuuksia niillä voi tai täytyy olla ja millaisia
yhteyksiä objektien välillä on. Metamallin loogiset riippuvuudet määrittelevät
suunnittelun työtapoja ja järjestystä. Ne kuvaavat millaiset tietomallit ovat
suunnittelujärjestelmän kannalta hyväksyttäviä tehdasmalleja. Ne määräävät myös
suunnittelujärjestelmän laajuuden. Metamallin määritteleminen tekee
suunnittelutyön tuloksesta ennakoitavan ja mahdollistaa suunnittelun
apuvälineiden kehittämisen. Suunnittelutyön formalisoimisella myös suljetaan
pois eriäviä tapoja kuvata tehdasta ja mahdollistetaan formalismiin perustuvat
työkalut ja suunnittelukäytännöt. 

Suunnittelutyössä käytettävät metamallit valitaan siten, etteivät ne ole
ristiriidassa ja muodostavat yhdessä toisiaan täydentävän kokonaisuuden. Tällöin
metamallien konfiguraatio muodostaa itsessään mallin.

%Valmiiden grafiikkakirjastojen käyttöä on tutkinut Kääriäinen, jonka mukaan
%työssä .
%http://mv-sirius.fh-offenburg.de/ecmIC/SensorActuatorObj-Worksheet/atr_2001.pdf
%%%
	\subsection{Automaatiojärjestelmän logiikka}
%%%

Teollisuuden hajautettujen ohjausjärjestelmien suunnittelussa on havaittu
tarpeelliseksi ainakin kolme näkymää \cite{RefWorks:38}: funktionaalinen näkymä,
fyysinen näkymä sekä ohjelmistonäkymä.

Näistä ensimmäinen määrittelee järjestelmän toiminnallisuuden. Tätä näkymää
määritettäessä voivat eri alojen suunnittelijat osallistua työhön ilman
tuntemusta instrumentoinnista tai ohjelmistokehityksestä. Kun päätökset on tehty
abstraktilla tasolla, voidaan hankinnat räätälöidä sen mukaisesti ja tulos
toteuttaa tehokkaasti. Funktionaalisuuden suunnitteluprosessin tuloksena on usein
PI-kaavio joka yleensä toimii esisuunnittelutietona muille näkymille.

Fyysiseen näkymään suunnitellaan järjestelmän johdotukset, kaapelit, kenttäväylät,
ohjauskeskukset, toimilaitteiden sijainnit sekä ylipäänsä kaikki mitä vaaditaan 
järjestelmän fyysiseen käyttöönottoon.

Ohjelmistonäkymä kattaa funktionaalisen suunnittelun toteutuksen ohjelmamuodossa.
Ohjelmistototeutus jää suunnitteluprosessissa harvinaisen vähäiselle formaaliuden asteelle,
vaikka pyrkimyksiä siihen suuntaan on ollut.

Projektin edetessä konseptista toteutukseksi huomataan, että tuotetut dokumentit ovat kahdenlaisia.
Ne voitaisiin luonnehtia suunnittelutyön sivutulokseksi sekä lopputulokseksi.
Suunnittelutyön tavoitteen toteuttava dokumentti saattaa olla ainoa joka näkee päivänvalon.
Tässä työssä tarkastellaan tapoja joilla suunnittelutyön tuottamia malleja voidaan muuntaa
toisiksi, käyttökelpoisiksi malleiksi kuten logiikkadiagrammeiksi.

%%%
	\subsection{Logiikkadiagrammit}
%%%

% IEC 61804, dokumentoinnin standardit.

Hajautetun ohjausjärjestelmän logiikan suunnittelulle ja toteutukselle ei ole
laajassa käytössä olevaa standardia, pikemminkin joukko standardeja joita
käytetään vaihtelevasti. Suunnitteluohjelmistojen valmistajat myös jättävät usein
standardinmukaiseksi kutsutuista ohjelmistoista standardin ominaisuuksia toteuttamatta.\cite{RefWorks:42}

IEC~61131-3 ja myöhemmin sitä täydentänyt IEC~61499 ovat pyrkimyksiä tuottaa
avoin standardi joka määrittelee automaatiojärjestelmän ohjelmoinimenetelmät ja
on riittävän joustava mihin tahansa tarkoitukseen. Se sisältää 4+1 eri
ohjelmointikieltä, joista tässä työssä käsitellään erityisesti FBDtä.

Logiikkadiagrammit pelkistävät syöttöjen ja lähtöjen välisen logiikan
yksinkertaiseksi ja intuitiiviseksi esitykseksi. Vaikka ohjausjärjestelmän
ohjelmointi toteutettaisiinkin muunlaisella esityksellä, esimerkiksi
tikapuukaaviolla, on silti usein helpompaa ymmärtää ohjelman rakenne
logiikkadiagrammien avulla. Lisäksi logiikkadiagrammit helpottavat tehtaan
toiminnan ymmärrystä suunnittelu- ja rakennusvaiheen lisäksi tehtaan ylläpidon
ja huollon yhteydessä ja ovat siksi tärkeä osa tehtaan lopullista
dokumentaatiota.

Toimilohkot kuvaavat toisistaan erillisiä itsenäisiä laskennallisia yksiköitä
ja niitten relaatioita toisiinsa. Funktioblokki voi tilastaan riippuen lähettää
tapahtumia jotka vaikuttavat muitten blokkien toimintaan. Sen tekemien
laskutoimitusten tulos riippuu sen vasemmalta puolelta tulevista
syöttötiedoista ja sen suorittaman laskennan tulokset lähetetään blokin oikealta puolelta.
Toisiinsa liitetyt funktioblokit muodostavat funktioblokkiverkon, joka määrittelee laajemman toiminnallisuuden.


% Although the IEC 61499 is not always seen as the ultimate solution, it is a useful and powerful basis for engineering tools that follow an abstract, model-driven approach and can generate the actual function blocks and their interconnections automatically from a high-level description of the required functionalities." -10.1109/MIE.2011.942175 (Sauter et. al. IEEE Industrial electronics magazine, p. 35)

% Toimintakaavio määrittelee ohjausjärjestelmän toimintoja. Se tavallisesti valmistellaan järjestelmän suunnittelun varhaisessa vaiheessa prosessikaaviosta. toimintakaaviota pidetään ajantasaisena järjestelmän suunnittelun edetessä. Se toimii suunnittelun apuna ja on lopulta osa lopullisen järjestelmän ohjeistusta.

% http://mv-sirius.fh-offenburg.de/ecmIC/SensorActuatorObj-Worksheet/atr_2001.pdf

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	\clearpage
	\section{Hierarkinen graafinpiirto}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% http://www.cs.brown.edu/~rt/gdhandbook/
%%%%%%%%%%%%%%%%%%%%%

Hierarkisen lähestymistavan kerrostettujen suunnattujen graafien piirtämiseen
esittivät Sugiyama et. al vuonna 1981 \cite{RefWorks:9}. Tämä lähestymistapa on
osoittautunut tehokkaaksi ja on ollut jatkokehityksen- ja tutkimuksen kohteena
\cite{RefWorks:28}.

Hierarkinen lähestymistapa koostuu kolmesta vaiheesta:
\begin{enumerate}
  \item Syklien poisto
  \item Kerrostus
  \item Risteysten vähentäminen
  \item Poikittainen asettelu
\end{enumerate}
Lisäksi piirrettävän graafin täytyy olla etukäteen valiidisti muotoiltu ja syklitön.

Automaatiokaavioiden suoritusjärjestyd etenee standardin IEC 61131-3 mukaan
vasemmalta oikealle. Lisäksi funktioblokkia ei ajeta ennen
kuin kaikki sitä edeltävät funktioblokit on suoritettu.
Keskinäisen suoritusjärjestyksen täytyy myös tulla esille toteuttavassa ohjelmistossa.

Suoritusjärjestysvaatimus asettaa myös toteutukselle rajoituksia. Jos tätä ei oteta
huomioon, saattaa graafin algoritmillinen piirto johtaa vääränlaiseen kaavioon.

Tämä työ olettaa että eri ohjelmien suoritusjärjestys niillä kohdin kuin se on
olennaista on tiedossa ja merkittynä tietokantaan.
Myös mahdollisten takaisinkytkentöjen tapauksessa täytyy olla huolellinen, jottei syklien poistovaiheessa kaavion järjestys muutu dramaattisesti.

Työvaiheista kerrostus ja risteyksien vähennysvaihe saattavat muuttaa suoritusjärjestystä. Tällöin algoritmin toimintaa pitää yksinkertaisesti rajoittaa järjestysherkkien blokkien osalta. Koska algoritmit ovat heuristisia, ovat siihen tehtävät yksinkertaiset rajoitukset helppoja toteuttaa.

		\subsection{Syklien poisto}

Jos graafissa on syklejä, eli graafi ei ole suunnattu, käännetään syklin
aiheuttavien lankojen suunta ja tehdyt muutokset merkitään muistiin.
Graafinpiirron lopuksi syklit käännetään takaisin oikein päin.

		\subsection{Kerrostus}

Kerrostetuksen graafin tulee olla olla kompakti. Tämä tarkoittaa että sen leveys
ja pituus ovat pieniä ja kerrosten välinen etäisyys on vakio. Graafin pituuden
alaraja on pisimmän yhtenäisen ketjun pituus.
Erilaisilla kerrostusmenetelmillä graafin pituus voidaan
minimoida leveyden kustannuksella tai siitä voidaan tehdä mahdollisimman kapea
pituuden kustannuksella.

Sekä leveyden että pituuden minimointi samanaikaisesti on rinnastettavissa
multiprosessoriajastusongelmaan ja siten NP- täydellinen ongelma.
\cite{RefWorks:39} Multiprosessoriongelmaa varten suunniteltu algoritmi,
Coffman-Graham-kerrostusmenetelmä tarjoaa tällöin ratkaisun tähän ongelmaan.

		\subsection{Risteyksien vähentäminen}

Risteyksien vähentäminen ei perustu solmujen tarkkoihin sijainteihin, vaan
niitten keskinäiseen järjestykseen. Ongelma on siis luonteeltaan kombinatorinen
eikä geometrinen, mikä huomattavasti yksinkertaistaa ongelman ratkaisemista.
Tästä helpotuksesta huolimatta kyseessä on NP-täydellinen ongelma siinäkin
tapauksessa että kerroksia no vain kaksi. \cite{RefWorks:40}

Lähestymistapoja risteyksien vähentämiseen on vierekkäisten noodien paikkojen
vaihtelu keskenään sekä mediaanimenetelmä, jossa noodi asetetaan paikalle, joka
on siihen yhtyneiden solmujen puolivälissä.

%Tähän se väikkäri myös! (P. Eades, ”Heuristics for Reducing crossings in
%2-layered networks”, E. Mäkinen, ”experiments of drawing 2-level hierarchical
%graphs”, M. Jünger, ”2-layer straightline crossing minimization: Perf…” )
Monet ovat tutkineet erilaisia risteysalgoritmeja.
Yhtä selkeästi parasta menetelmää ei ole kuitenkaan löytynyt.
Sen sijaan paras lähestymistapa on osoittautunut algoritmeja
yhdisteleväksi heuristiseksi hybridialgoritmiksi.

Tässä menetelmässä solmut uudelleenjärjestetään joka iteraation yhteydessä mediaanimenetelmällä. Sen jälkeen 
luodaan joukko lähes identtisiä järjestelyitä joissa esiintyy paikallisia transpositioita
Lopulta valitaan paras tulos seuraavaa iteraatiota varten.
Ratkaisua voisi luonnehtia tietynlaiseksi geneettiseksi algoritmiksi.

%Optimizing Automatic Layout for Data Flow Diagrams, 2011, Diploma thesis,
%Christian-Albrechts-Universität zu Kiel, Department of Computer Science

		\subsection{Poikittainen asettelu}

Jokainen kulma langassa aiheuttaa ylimääräisen rasitteen ihmisen hahmotuskyvyssä.
Asettelun merkitys korostuu kun lankoja on paljon.
Solmujen poikittaisen asettelun avulla solmujen välisten lankojen käännösten
määrää pyritään vähentämään jotta kaavion luettavuus paranee.
Koska risteysten määrä riippyy solmujen keskinäisestä järjestyksestä ja
risteysten vähentämisvaiheessa saavutettu kombinatorinen ratkaisu säilyy, poikittaisasettelussa,
ei risteysten määrä muutu poikittaisasetteluvaiheessa.
Poikittainen asettelu on tärkeä lopputuloksen luettavuuden kannalta.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	\clearpage
	\section{Menetelmät ja esimerkki}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5

		\subsection{Kaavioiden tuottaminen}

Käytännön toteutuksia hierarkisesta graafinpiirtomenetelmästä on useita
(viittaa: graphviz, tulip, kieler)’
An open graph visualization system and its applications to software engineering
(2000) 

Automatic generation of PLC automation projects

from component-based models
Elisabet Estévez
Käytännönläheinen selostus siitä, kuinka aiempaa teoriaa sovelletaan.

		\subsection{Kaavioiden tuottaminen}
			\subsubsection{Vertaillut vaihtoehdot}
	
Funktioblokkien editointiin on olemassa useita työkaluja.
Rockwell Automationin ilmainen funktioblokkieditori, FBDK on tutkimuksessa
laajassa käytössä.
FBDK ei kuitenkaan tarjoa tapoja muuttaa kaavion asettelua algoritmillisesti.
FBench on avoimen lähdekoodin standardimukainen ohjelmisto, joka kuitenkin
kärsii samoista puutteista kuin FBDK.
PROFACTORin kehittämä 4DIAC tarjoaa standardeja noudattavan
funktioblokkieditorin.
Se ei kuitenkaan mahdollista blokkien välisten lankojen reitittämistä.
ISaGRAF ja NxtControl ovat kaupallisesti tuotettuja ohjelmistoja joita ei
valitettavasti voitu työtä varten arvioida.

			\subsubsection{KIELER}

Koeohjelmistoksi valittiin KIELER, Kielin yliopistossa kehitetty yleiseen
graafinpiirtoon tuotettu ohjelmisto, jolle on kehitetty IEC 61499-standardin
mukaisten funktioblokkidiagrammien piirto-ohjelmisto CAKeFEED. 
Kerrotaan tarkemmin ohjelmistosta jolla koe on suoritettu

		\subsection{Tulosten arviointiperusteet}

Lankojen risteämismäärien minimointi !
Ortogonaalisuus!
Graph Layout Aesthetics in UML Diagrams: User Preferences

The Aesthetics of Graph Visualization

	\clearpage
	\section{Tulokset}
	
Olemme osoittaneet yhteyden graafiteorian suunnatuilla puilla ja
logiikkadiagrammeilla ja näyttäneet miten graafipiirtoalgoritmeja voidaan
käyttää automaatiokaavioiden generointiin.
Tapa X on kivempi kuin tapa Y.

	\section{Yhteenveto ja tulevaisuudennäkymät}

Tehtaan automaatiosuunnittelun yhtenäistämiseksi on vuosien varrella esitetty akateemisissa piireissä
runsaasti mielipiteitä. Nämä jäävät usein abstraktille, suunnittelijat vieraannuttavalle tasolle.
Nykyhetken suurimpana haasteena ei ole, mikä on oikea tapa hahmottaa järjestelmä, vaan pikemmin
miten asia voidaan toteuttaa.

Tämä kandidaatintyö on pyrkinyt tarjoamaan konkreettisen ratkaisun konkreettiseen suunnittelutyön ongelmaan, graafinpiirtoon. 

Vaikka automaatiokaavioiden tuottamisen automatisointi onnistuttaisiin tekemään,
on se vain yksi viidestä erilaisesta suunnitelunäkymästä.

Automaatiosuunnittelu on siirtynyt yhä enemmän tietopohjaisesta tutkimuksesta

RDF:ää voidaan käyttää tehtaan PI-kaavion miettimiseen.
Graph theory - An RDF model is a labeled, directed multi-graph


\clearpage
\addcontentsline{toc}{section}{Viitteet}

\bibliography{kandi}
\makeindex
\end{document}
