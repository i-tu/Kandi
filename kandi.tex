	\documentclass[finnish,12pt]{article}
	\usepackage{aaltothesis}
       \usepackage[utf8]{inputenc}


	%% Use this if you run latex and use eps-format pictures
	%\usepackage[dvips]{graphicx}
	\usepackage[pdftex]{graphicx} 

	\usepackage[pdfpagemode=None,colorlinks=true,urlcolor=red,linkcolor=blue,citecolor=black,pdfstartview=FitH]{hyperref}

	%% Use this if you do not like hyperref package - this defines url environment and formats it correctly
	%\usepackage{url}

	% Math stuff
	\usepackage{amsfonts,amssymb,amsbsy}

	\usepackage{setspace}
	\onehalfspacing
	
  \usepackage{lmodern}
	
	% Layout
	\setlength{\hoffset}{-1in}
	\setlength{\oddsidemargin}{35mm}
	\setlength{\evensidemargin}{25mm}
	\setlength{\textwidth}{15cm}
	\setlength{\voffset}{-1in}
	\setlength{\headsep}{7mm}
	\setlength{\headheight}{1em}
	\setlength{\topmargin}{25mm-\headheight-\headsep}
	\setlength{\textheight}{23cm}

	
	\begin{document}
	
	\bibliographystyle{unsrt}

	\university{Aalto-yliopisto}
	\school{Sähkötekniikan korkeakoulu}

	\faculty{Automaatio- ja systeemitekniikan laitos}
	\degreeprogram{Automaatio- ja systeemitekniikka}
	\univdegree{BSc}
	\author{Ian Tuomi}
	\thesistitle{Automaatiokaavioiden generointi}
	\place{Espoo}
	\date{5.12.2012}
	\supervisor{DI Marek Matusiak}
	\instructor{DI Mika Strömman}
	\uselogo{red}{!}{tkk}
	\makecoverpage

	\keywords{PLC ß JOOJJEEE}
	%% Tiivistelmän tekstiosa
	\begin{abstractpage}[finnish]
  
Tämän tutkimuksen kohteena on järjestelmän ohjauslogiikan formaalin kuvauksen muuntaminen standardeita noudattavaksi logiikkakaavioksi.
  
	\end{abstractpage}

	\newpage
	\vspace{10cm}
	\mysection{Esipuhe}

Haluan kiittää seuraavia ihmisiä joita ilman en olisi onnistunut tässä työssä.

Ohjaajaani Mika Strömmania hyvistä huomioista,  asiallisesta palautteesta ja skarpista ohjauksesta.

Kandiryhmäni jäseniä Lauri Vepsäläistä, Heikki 'Taffis' Tahvanaista, Panu Kauppista, Peter 'Bembu'  Kronströmiä ja Lauri Andleria.

Kandikurssin järjestäjää 

Petri Kokkoa ja Pekka Niemistä ideoinnista ja suunnannäyttämisestä.

Aalto- yliopiston henkilökuntaa hyvästä työstä.
Vanhempiani tuesta ja kannustuksesta.
\\

	\vspace{5cm}

Otaniemi, 16.3.2010

	\vspace{5mm}
	{\hfill Ian Tuomi \hspace{1cm}}

	\newpage

	\addcontentsline{Sisällysluettelo}

	\tableofcontents


	%% Symbolit ja lyhenteet
	\mysection{Lyhenteet}

	\begin{tabular}{ll}
DCS        & Distributed Control System \\
	     & Hajautettu ohjausjärjestelmä \\
FBD         & Function Block Diagram, IEC 61131-3 -standardin määrittelemä logiikkaohjelmointikieli\\
IEC          & Internation Electrotechnical Commission \\
PLC         & Programmable Logic Circuit \\
	      & Ohjelmoitava logiikkapiiri \\

	\end{tabular}

	\cleardoublepage
	\storeinipagenumber
	\pagenumbering{arabic}
	\setcounter{page}{1}

	\section{Johdanto}
	\thispagestyle{empty}

Teollisuuden automaatiojärjestelmän suunnittelutyön tulos koostuu kaavioista - laajan järjestelmän tapauksessa jopa tuhansista sellaisista. Kaaviot muodostavat kuvauksen joka mahdollistaa tehtaan toteutuksen, käyttöönoton ja ylläpidon. Kaavioiden piirtäminen käsin on suurissa projekteissa työlästä ja tehotonta. Nykyaikaisessa tehdassuunnittelussa ongelma korostuu. Ratkaisuista on tullut monimutkaisempia ja laatu- ja joustavuusvaatimukset ovat kasvaneet. Lisäksi suunnitteluprojektien suunnitteluaika on jatkuvasti lyhentynyt. \cite{RefWorks:41}

Tämän vuoksi suunnitteluprosessia on pyritty tehostamaan automatisoiduilla suunnittelun apuvälineillä. Suunnittelumetodiikat eivät kuitenkaan ole ilmeisistä standardoimiseduista huolimatta yhtenäistyneet, ja yhteistyö alan tutkimuksessa on vähäistä. Vaikka lähestymistavat ovat vaihtelevia, on tehdassuunnittelussa kuitenkin nähtävissä yhtenäinen siirtymä kohti tehtaan tietomalleja. Suunnittelujärjestelmään syntyy tällöin projektin edetessä tehtaan tietomalli johon tehtaan kaikki sähköistys ja instrumentointi automaatiojärjestelmineen ja kenttälaitteineen on merkitty. Erilaiset kaaviot voidaan tuottaa suoraan tietomallin sisältävästä tietokannasta.

Tietomalliin perustuva lähestymistapa vaatii tietomallin rajoitukset määrittelevän metamallin. Tämä ohjaa ja määrittää suunnittelun kohteen lisäksi myös suunnittelutyön kulkua.

Tämän tutkimuksen kohteena on tehtaan hajautetun ohjausjärjestelmän logiikan tietomallin muuntaminen standardeja noudattavaksi logiikkakaavioksi. Logiikkakaaviot ovat tapa pelkistää syöttöjen ja lähtöjen välillä vallitseva logiikka. Logiikkakaavio on määritelty yksiselitteisesti ja on tulkittavissa suunnatuksi graafiksi, jolloin algoritmillisen graafinpiirron tuloksia voidaan hyödyntää.

Algoritmillinen graafipiirto on perusteellisesti tutkittu ala, jonka tuloksia voidaan käyttää kaikenlaisten suunnattujen kaavioiden piirtoon. Esittelemme Sugiyaman et. al. \cite{RefWorks:9} esittämään hierarkiseen lähestymistapaan perustuvan algoritmin jonka avulla lopullinen kaavio piirretään.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	\clearpage
	\section{Tehtaan mallit ja mallinnustavat}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Tehdasmalli on kuvaus joka mahdollistaa tehtaan toteutuksen, käyttöönoton ja ylläpidon. Se on tietomalli joka kuvaa laajuudestaan riippuen tehtaan toimintaa, sen prosessia, organisaatiota, ihmisiä ja näitten aktiviteetteja. Tehdasmalli koostuu pohjimmiltaan tehdasobjekteista, niitten ominaisuuksista ja niitten välisistä relaatioista. \cite{RefWorks:41}

Suunnittelijoilla on työtehtävistään riippuen erilaisia tarpeita tehdasmallin suhteen. Työn kohde on monitahoinen eikä mikään yksi malli pysty kattamaan kaikkia suunniteltavan järjestelmän näkymiä. Tehdasta tulee kuvata useilta eri näkökannoilta erilaisilla tarkkuuksilla kunkin näkymän vaatimuksien mukaisesti. Tehdasmalliin kuuluu siis useita malleja, jotka yhdessä muodostavat kokonaisen systeemin.

Jokaisella mallilla on myös metamalli joka määrittelee millaisia objekteja malli voi sisältää, mitä ominaisuuksia niillä voi tai täytyy olla ja millaisia yhteyksiä objektien välillä on. Metamallin loogiset riippuvuudet määrittelevät suunnittelun työtapoja ja järjestystä. Ne kuvaavat millaiset tietomallit ovat suunnittelujärjestelmän kannalta hyväksyttäviä tehdasmalleja. Ne määräävät myös suunnittelujärjestelmän laajuuden. Metamallin määritteleminen tekee suunnittelutyön tuloksesta ennakoitavan ja mahdollistaa suunnittelun apuvälineiden kehittämisen. Suunnittelutyön formalisoimisella myös suljetaan pois eriäviä tapoja kuvata tehdasta ja mahdollistetaan formalismiin perustuvat työkalut ja suunnittelukäytännöt. 

Suunnittelutyössä käytettävät metamallit valitaan siten, etteivät ne ole ristiriidassa ja muodostavat yhdessä toisiaan täydentävän kokonaisuuden. Tällöin metamallien konfiguraatio muodostaa itsessään mallin.

%Hajottamalla suunnitteluprosessi kahteen voidaan prosessia kehittää ja siitä keskustella ilman syvällistä tuntemusta instrumenteista. Kun päätökset on tehty abstraktilla tasolla, voidaan hankinnat räätälöidä sen mukaisesti ja tulos toteuttaa tehokkaasti.

%Tässä työssä tarkastellaan tapaa jolla suunnittelutyön työmalli voidaan muuntaa toiseksi malliksi.

%Projektin edetessä konseptista toteutukseksi huomataan, että vähintään kahdenlaisia dokumentteja tarvitaan. Toteuttava dokumentti saattaa olla ainoa, joka näkee päivänvalon. 

%Valmiiden grafiikkakirjastojen käyttöä on tutkinut Kääriäinen, jonka mukaan työssä .
%http://mv-sirius.fh-offenburg.de/ecmIC/SensorActuatorObj-Worksheet/atr_2001.pdf
%%%
	\subsection{Automaatiojärjestelmän logiikka}
%%%

Teollisuuden hajautettujen ohjausjärjestelmien suunnittelussa on havaittu tarpeelliseksi ainakin kolme näkymää \cite{RefWorks:38}: säätötekninen näkymä, sähkötekninen näkymä sekä ohjelmistokehitysnäkymä.

Näistä ensimmäinen määrittelee järjestelmän toiminnallisuuden. Tätä näkymää määritettäessä voivat eri alojen suunnittelijat osallistua työhön ilman tuntemusta instrumentoinnista tai ohjelmistokehityksestä. Kun päätökset on tehty abstraktilla tasolla, voidaan hankinnat räätälöidä sen mukaisesti ja tulos toteuttaa tehokkaasti. Säätöteknisen suunnitteluprosessin tuloksena on usein PI-kaavio joka usein toimii esisuunnittelutietona muita näkymiä suunniteltaessa.

Projektin edetessä konseptista toteutukseksi havaitaan, että . Toteuttava dokumentti saattaa olla ainoa, joka näkee päivänvalon. 

Kaksi jälkimmäistä määrittelevät järjestelmän toteutuksen. 

Hajautetun ohjausjärjestelmän logiikan suunnittelulle ja toteutukselle ei ole laajassa käytössä olevaa standardia, pikemminkin joukko standardeja joita käytetään vaihtelevasti. Ohjelmointi on vanha ja intuitiivinen ala. Vaikka olisi selviä syitä suunnittelun formalisoitumiselle, näin ei ole kuitenkaan laajassa mittakaavassa käynyt.

Tässä työssä tarkastellaan tapaa jolla suunnittelutyön työmalli voidaan muuntaa toiseksi malliksi.

%%%
	\subsection{Logiikkadiagrammit}
%%%

IEC~61131-3 ja myöhemmin sitä täydentänyt IEC~61499 ovat pyrkimyksiä tuottaa avoin standardi joka määrittelee automaatiojärjestelmän ohjelmoinimenetelmät ja on riittävän joustava mihin tahansa tarkoitukseen. Se sisältää 6 eri ohjelmointikieltä, joista käsittelemme

Logiikkadiagrammit pelkistävät syöttöjen ja lähtöjen välisen logiikan yksinkertaiseksi ja intuitiiviseksi esitykseksi. Vaikka ohjausjärjestelmän ohjelmointi toteutettaisiinkin muunlaisella esityksellä, esimerkiksi tikapuukaaviolla, on silti helpompaa ymmärtää ohjelman rakenne logiikkadiagrammien avulla. Lisäksi logiikkadiagrammit helpottavat tehtaan toiminnan ymmärrystä suunnittelu- ja rakennusvaiheen lisäksi tehtaan ylläpidon ja huollon yhteydessä ja ovat siksi tärkeä osa tehtaan lopullista dokumentaatiota.

Funktioblokit kuvaavat toisistaan erillisiä itsenäisiä laskennallisia yksiköitä ja niitten relaatioita toisiinsa. Funktioblokki voi tilastaan riippuen lähettää tapahtumia jotka vaikuttavat muitten blokkien toimintaan. Funktioblokin tekemien laskutoimitusten tulos riippuu siis sen vasemmalta puolelta tulevista syöttötiedoista. Laskennan tulokset lähetetään blokin oikealta puolelta. Toisiinsa liitetyt funktioblokit muodostavat funktioblokkiverkon. 

IEC 61499 määrittelee XML-kuvauksen funktioblokkiverkoille.

% Although the IEC 61499 is not always seen as the ultimate solution, it is a useful and powerful basis for engineering tools that follow an abstract, model-driven approach and can generate the actual function blocks and their interconnections automatically from a high-level description of the required functionalities." -10.1109/MIE.2011.942175 (Sauter et. al. IEEE Industrial electronics magazine, p. 35)

% Toimintakaavio määrittelee ohjausjärjestelmän toimintoja. Se tavallisesti valmistellaan järjestelmän suunnittelun varhaisessa vaiheessa prosessikaaviosta. toimintakaaviota pidetään ajantasaisena järjestelmän suunnittelun edetessä. Se toimii suunnittelun apuna ja on lopulta osa lopullisen järjestelmän ohjeistusta.

% http://mv-sirius.fh-offenburg.de/ecmIC/SensorActuatorObj-Worksheet/atr_2001.pdf

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	\clearpage
	\section{Hierarkinen graafinpiirto}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% http://www.cs.brown.edu/~rt/gdhandbook/
%%%%%%%%%%%%%%%%%%%%%

Hierarkisen lähestymistavan kerrostettujen suunnattujen graafien piirtämiseen esittivät Sugiyama et. al vuonna 1981 \cite{RefWorks:9}. Tämä lähestymistapa on osoittautunut tehokkaaksi ja on ollut jatkokehityksen- ja tutkimuksen kohteena \cite{RefWorks:28}.

Hierarkinen lähestymistapa koostuu kolmesta vaiheesta: kerrostamisesta, risteämisten vähentämisestä ja poikittaisasettelusta. Lisäksi piirrettävän graafin täytyy olla etukäteen valiidisti muotoiltu ja syklitön.

Automaatiokaavioiden suoritusjärjestys on määritelty standardissa IEC 61131-3 ylhäältä alas, vasemmalta oikealle. Lisäksi funktioblokkia ei toteuteta ennen kuin kaikki sitä edeltävät funktioblokit on suoritettu. Suoritusjärjestysvaatimus asettaa toteutukselle rajoituksia. Jos tätä ei oteta huomioon, saattaa graafin algoritmillinen piirto johtaa vääränlaiseen kaavioon.

Kun kuvauksessa määritellään suoritusjärjestyksessä ensimmäinen. Risteyksien vähennysvaihe on ainoa osio jossa uudelleenjärjestely saattaa muuttaa suoritusjärjestystä. 

Tämän vuoksi on otettu käyttöön tätä tilannetta varten tehty algoritmi. Tämä työ olettaa lisäksi , että eri ohjelmien suoritusjärjestys niillä kohdin, kuin se on olennaista, on tiedossa ja merkittynä tietokantaan. Koska suoritusjärjestyksen eteneminen on määritelty tavalla X, voidaan käyttää algoritmia sillä rajoituksella, että Y. 

Logiikkakaavioissa on usein 

		\subsection{Syklien poisto}

Jos graafissa on syklejä, eli graafi ei ole suunnattu, käännetään syklin aiheuttavien lankojen suunta ja tehdyt muutokset merkitään muistiin.
Tätä varten on kehitetty useita erilaisia algoritmeja.

		\subsection{Kerrostus}

Kerrostetuksen graafin tulee olla olla kompakti. Tämä tarkoittaa että sen leveys ja pituus ovat pieniä ja kerrosten välinen etäisyys on vakio. Graafin pituuden alaraja on pisimmän . Erilaisilla kerrostusmenetelmillä graafin pituus voidaan minimoida leveyden kustannuksella tai siitä voidaan tehdä mahdollisimman kapea pituuden kustannuksella.

Leveyden ja pituuden minimointi on  rinnastettavissa multiprosessoriajastusongelmaan ja siten NP- täydellinen ongelma. \cite{RefWorks:39}. Multiprosessoriongelmaa varten suunniteltu algoritmi, Coffman-Graham-kerrostusmenetelmä (Coffman, Optimal scheduling for two processor systems, 1972) tarjoaa ratkaisun tähän ongelmaan.

Se palauttaa graafin, jolla on jokin minimileveys, alkuperäisessä toteutuksessa prosessorien määrä, omassa tapauksessamme arkin korkeus. 
Algoritmin tavoitteena on varmistaa, että 


		\subsection{Risteyksien vähentäminen}

Risteyksien vähentäminen ei perustu solmujen tarkkoihin sijainteihin, vaan niitten keskinäiseen järjestykseen. Ongelma on siis luonteeltaan kombinatorinen eikä geometrinen, mikä huomattavasti yksinkertaistaa ongelman ratkaisemista. Tästä helpotuksesta huolimatta kyseessä on NP-täydellinen ongelma siinäkin tapauksessa että kerroksia no vain kaksi \cite{RefWorks:40}

Lähestymistapoja risteyksien vähentämiseen on vierekkäisten noodien paikkojen vaihtelu keskenään sekä mediaanimenetelmä, jossa noodi asetetaan paikalle, joka on siihen yhtyneiden solmujen puolivälissä.

Monet tutkijat ovat
%Tähän se väikkäri myös! (P. Eades, ”Heuristics for Reducing crossings in 2-layered networks”, E. Mäkinen, ”experiments of drawing 2-level hierarchical graphs”, M. Jünger, ”2-layer straightline crossing minimization: Perf…” )
tutkineet eri risteysalgoritmeja. Yhtä selkeästi parasta menetelmää ei ole löytynyt. Sen sijaan paras lähestymistapa on osoittautunut algoritmeja yhdisteleväksi hybridialgoritmiksi.

(Joku et al on) saavuttanut hyviä tuloksia iteroimalla joka iteraation yhteydessä ensin uudelleenjärjestää solmut mediaanimenetelmällä, tekee paikallisia transpositioita ja lopulta pitää parhaan tuloksen seuraavaa iterointia varten.


Optimizing Automatic Layout for Data Flow Diagrams, 2011, Diploma thesis, Christian-Albrechts-Universität zu Kiel, Department of Computer Science

		\subsection{Poikittainen asettelu}

Solmujen poikittainen asettelun avulla solmujen välisten lankojen käännösten määrää pyritään vähentämään, jotta kaavion luettavuus paranee.
Risteyksien vähentämisvaiheessa saavutettu kombinatorinen ratkaisu ja sitä myötä risteysmäärä säilyy.
Poikittainen asettelu on tärkeä lopputuloksen luettavuuden kannalta.


%%%%%%%
%REMOVE ME LATER %
\addcontentsline{toc}{section}{Viitteet} %
\bibliography{kandi} %
\makeindex %
 \end{document} %
%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	\clearpage
	\section{Menetelmät ja esimerkki}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5

		\subsection{Kaavioiden tuottaminen}

Käytännön toteutuksia hierarkisesta graafinpiirtomenetelmästä on useita (viittaa: graphviz, tulip, kieler)’
An open graph visualization system and its applications to software engineering (2000) 

Automatic generation of PLC automation projects

from component-based models
Elisabet Estévez
Käytännönläheinen selostus siitä, kuinka aiempaa teoriaa sovelletaan.

		\subsection{Kaavioiden tuottaminen}
			\subsubsection{Vertaillut vaihtoehdot}
	
Funktioblokkien editointiin on olemassa useita työkaluja.
Rockwell Automationin ilmainen funktioblokkieditori, FBDK on tutkimuksessa laajassa käytössä.
FBDK ei kuitenkaan tarjoa tapoja muuttaa kaavion asettelua algoritmillisesti.
FBench on avoimen lähdekoodin standardimukainen ohjelmisto, joka kuitenkin kärsii samoista puutteista kuin FBDK.
PROFACTORin kehittämä 4DIAC tarjoaa standardeja noudattavan funktioblokkieditorin.
Se ei kuitenkaan mahdollista blokkien välisten lankojen reitittämistä.
ISaGRAF ja NxtControl ovat kaupallisesti tuotettuja ohjelmistoja joita ei valitettavasti voitu työtä varten arvioida.

			\subsubsection{KIELER}

Koeohjelmistoksi valittiin KIELER, Kielin yliopistossa kehitetty yleiseen graafinpiirtoon tuotettu ohjelmisto, jolle on kehitetty IEC 61499-standardin mukaisten funktioblokkidiagrammien piirto-ohjelmisto CAKeFEED. 
Kerrotaan tarkemmin ohjelmistosta jolla koe on suoritettu

		\subsection{Tulosten arviointiperusteet}

Lankojen risteämismäärien minimointi !
Ortogonaalisuus!
Graph Layout Aesthetics in UML Diagrams: User Preferences

The Aesthetics of Graph Visualization

	\clearpage
	\section{Tulokset}
	
Olemme osoittaneet yhteyden graafiteorian suunnatuilla puilla ja logiikkadiagrammeilla ja näyttäneet miten graafipiirtoalgoritmeja voidaan käyttää automaatiokaavioiden generointiin.
Tapa X on kivempi kuin tapa Y.

	\section{Yhteenveto ja tulevaisuudennäkymät}
	
Siistejä juttuja, joo. Ollaan saavutettu tavoite A. Tässä hommassa kokonaisuutena on vielä haasteita. Olisipa hienoa saada selville asia Z

Vaikka automaatiokaavioiden tuottamisen automatisointi onnistuttaisiin tekemään, on se vain yksi viidestä erilaisesta suunnitelunäkymästä.

Automaatiosuunnittelu on siirtynyt yhä enemmän tietopohjaisesta tutkimuksesta

RDF:ää voidaan käyttää tehtaan PI-kaavion miettimiseen.
Graph theory - An RDF model is a labeled, directed multi-graph


\clearpage
\addcontentsline{toc}{section}{Viitteet}

\bibliography{kandi}
\makeindex
\end{document}
